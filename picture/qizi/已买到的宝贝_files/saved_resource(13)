/*! messenger 2013-12-19 */
KISSY.add("tbc/messenger/1.1.5/index",function(a,b,c,d,e,f){function g(a,b){return x.push([a,b])-1}function h(a){return x[a]="1.1.5"}function i(a,b,c){y?j(a,b,c):z.push([a,b,c])}function j(c,d,f){var g={type:c,content:d},h=f;a.isString(f)?(h=b.get("#"+f),f=h.contentWindow):v||w||f.contentWindow&&(f=f.contentWindow),n()?f.KISSY.TBC.Messenger.fire(c,d):v?setTimeout(function(){o.callSWF?o.callSWF("send",[g,m(h)]):o.send(g,m(h))},500):f.postMessage(e.stringify(g),"*")}function k(b,c){a.each(x,function(a){a[0]===b&&a[1](c)})}function l(c,d){var e,f="parentFlash="+A+"&childFlash=_MessengerChildFlash_"+a.now()+"&domain="+document.domain;a.isString(c)?(e=c,c={}):e=c.src,c.src=e+(e.indexOf("?")>-1?"&":"?")+f;var g=b.create("<iframe>",c);return g.setAttribute("width",1),g.setAttribute("height",1),b.get(d||"body").appendChild(g)}function m(a){var b=a.src;if(b){var c=b.match(/childFlash=([^&]+)/);if(c&&c[1])return c[1];throw"iframe has no flashName param"}var d=/parentFlash=([^&]+)/,c=u.match(d);if(c&&c[1])return c[1];throw"iframe has no topFlashName param"}function n(a){var a=a||document.domain,b=/^taobao\.(com|net)$/;return b.test(a)?!0:!1}if(a.TBC&&a.TBC.Messenger)return!1;var o,p=window,q=a.namespace("TBC.Messenger"),r=-1===location.host.indexOf("daily")&&-1===location.host.indexOf("net"),s="1.1.5",t=s?"http://"+(r?"g.tbcdn.cn":"g.assets.daily.taobao.net")+"/tbc/messenger/"+s+"/flash-post-message.swf":"flash-post-message.swf",u=location.search,v="undefined"==typeof postMessage||!p.addEventListener,w=p.top!=p&&u.indexOf("domain")>-1,x=[],y=!v,z=[],A="_MessengerFlash_"+a.now();if(w){var B=/domain=([^&]+)/,C=location.search.match(B);C&&C[1]&&n(C[1])&&(document.domain=r?"taobao.com":"taobao.net")}if(n())y=!0;else if(v){window._Messenger_Flash_PostMessage=function(a,b){var c=b.type,d=b.msg;if("swfReady"===c){y=!0;for(var e;e=z.pop();)j.apply("1.1.5",e)}else"message"==c&&d&&k(d.type,d.content)};var C=u.match(/childFlash=([^&]+)/);C&&C[1]&&(A=C[1]);var D={src:t,attrs:{width:1,height:1,style:"position:absolute;top:0"},params:{flashVars:{jsentry:"_Messenger_Flash_PostMessage",swfid:"J_MessengerFlashPostMessage",name:A},allowscriptaccess:"always"}};parseFloat(a.version,10)>1.2?o=new f(D):a.Flash.add("#J_FlashPostMessageContainer",D,function(a){o=a.swf})}else p.addEventListener("message",function(b){var c=b.data;if(c&&a.isString(c))try{var d=e.parse(c);k(d.type,d.content)}catch(f){}},!1);return a.mix(q,{register:g,unregister:h,send:i,createIframe:l,fire:k,flashName:A})},{requires:["dom","event","ua","json",parseFloat(KISSY.version,10)>1.2?"swf":"flash"]});/*! umpp 2014-01-02 */
KISSY.add("tbc/umpp/1.4.9/mods/storage",function(a){var b,c,d=window,e=document,f=location.host,g=d.localStorage;return g?c={getItem:function(a){return g.getItem(a)},setItem:function(b,c){var d=c;return(a.isObject(d)||a.isArray(d))&&(d=a.JSON.stringify(c)),g.setItem(b,d.toString())},removeItem:function(a){return g.removeItem(a)},clear:function(){return g.clear()}}:(b=e.createElement("input"),b.type="hidden",b.style.behavior="url(#default#userData)",e.body.appendChild(b),c={getItem:function(a){var c;try{b.load(f),c=b.getAttribute(a)}catch(d){}return c},setItem:function(c,d){var e=d;a.isObject(e)&&(e=a.JSON.stringify(d));try{b.load(f),b.setAttribute(c,e.toString()),b.save(f)}catch(g){}},removeItem:function(a){try{b.load(f),b.removeAttribute(a),b.save(f)}catch(c){}},clear:function(){try{b.load(f),b.expires=new Date((new Date).getTime()-1e4).toUTCString(),b.save(f)}catch(a){}}}),c},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.9/mods/getNick",function(a){var b=a.namespace("TBC.umpp");return b.getNick=function(b){var c=a.Cookie.get("_nk_")||a.Cookie.get("lgc");return b?encodeURIComponent(unescape(c).replace(/\\u/g,"%u")):c}},{requires:["cookie"]}),KISSY.add("tbc/umpp/1.4.9/util/env/onLine",function(){return-1===location.host.indexOf("daily")}),KISSY.add("tbc/umpp/1.4.9/mods/server",function(a,b,c,d){function e(a){var b=a.split("}{"),c=a;return b.length>1?"{"+b[b.length-1]:c}function f(b,c){var d=b.st,e=[];if(d&&(a.each(d,function(a){a.key&&e.push(a.key)}),e.length)){var f=new Image;f.onload=function(){f.onload=null,f=null},f.src=c.mppHost+"/ack.do?key="+e.join(",")}}function g(a,b,c,d){var f,g=new XMLHttpRequest;g.onreadystatechange=function(){var a,h=g.responseText;h&&(a=JSON.parse(e(h)),3===g.readyState&&"2"==a.type?b(a):4===g.readyState&&(200===g.status?(c(a),f&&clearTimeout(f)):d()))},g.open("get",a,!0),g.send(),f=setTimeout(function(){g.abort(),d(),f=null},1e3*i)}function h(a,b,c){var d=location.search.match(/appId=(\d+)/),e=d&&d[1]?d[1]:1064,f="http://mpp."+(b?"taobao.com":"daily.taobao.net:8080"),g=f+"/buildconnection.do?ctype=login&appId="+e+"&nkh="+a;this.nick=a,this.url=g,this.success=c,this.mppHost=f,this.build()}var i=75,j=0,k=h.prototype;return k.build=function(e){var h=this,k=d(),l=h.url+"&t="+a.now();return e&&e.key&&(l+="&key="+e.key),k!==h.nick?!1:(e&&"chunked"===e.conn&&(b.ie>9||!b.ie)?g(l+"&stream=true",function(a){h.success(a.st),f(a,h)},function(a){h.dealData(a,!0)},function(){setTimeout(function(){h.build({conn:"chunked"})},1e3*Math.ceil(40*Math.random()))}):new c({type:"get",url:l,dataType:"json",timeout:i,success:function(a){j=0,h.dealData(a)},error:function(a){"timeout"===a?h.build():++j<5&&setTimeout(function(){h.build()},1e3*Math.ceil(40*Math.random()))}}),void 0)},k.dealData=function(a,b){if(!a)return!1;var c=a.type;if("1"==c||"2"==c){"2"==c&&a.st&&this.success(a.st),f(a,this);var d={};b?d.conn="chunked":a.conn&&(d.conn=a.conn),this.build(d)}else"5"==c&&(location.href="http://www.taobao.com/go/act/share/loginsuccess.php")},h},{requires:["ua","ajax","tbc/umpp/1.4.9/mods/getNick"]}),KISSY.add("tbc/umpp/1.4.9/connect",function(a,b,c,d,e,f,g,h,i,j,k){function l(c){a.each(c,function(c){var d=p+c.t1,e=h.getItem(d),f=c.content;if(f){if(e)try{f=b.parse(f),e=b.parse(e),a.isObject(f)?f=a.mix(e,f,{deep:!0}):a.isArray(f)&&(f=e.concat(f),f.length>50&&f.splice(0,f.length-50))}catch(g){f=f}h.setItem(d,f)}})}function m(a){return a&&a.length?(l(a),g.send("umppdata",a,n.parent),void 0):!1}var n=window,o=i(),p=o+"_";return{start:function(){g.register("umpp-store-set",function(a){h.setItem(p+a[0],a[1])}),g.register("umpp-store-get",function(a){var b=h.getItem(p+a);g.send("umpp-store-get-"+a,b,n.parent)}),g.register("umpp-store-remove",function(a){h.removeItem(p+a)}),g.send("umppready","ok",n.parent),new k(o,j,m)}}},{requires:["json","ua","cookie","ajax","swf","tbc/messenger/1.1.5/","tbc/umpp/1.4.9/mods/storage","tbc/umpp/1.4.9/mods/getNick","tbc/umpp/1.4.9/util/env/onLine","tbc/umpp/1.4.9/mods/server"]});