/*! umpp 2013-11-29 */
KISSY.add("tbc/umpp/1.4.4/mods/messenger",function(a){function b(a,b){return s.push([a,b])-1}function c(a){return s[a]=null}function d(b,c,d){var e={type:b,content:c},f=d;if(a.isString(d)?(f=l.get("#"+d),d=f.contentWindow):d.contentWindow&&(d=d.contentWindow),h())try{return d.KISSY.TBC.Messenger.fire(b,c)}catch(j){}n?i&&(i.callSWF?i.callSWF("send",[e,g(f)]):i.send(e,g(f))):d.postMessage(m.stringify(e),"*")}function e(b,c){a.each(s,function(a){a&&a[0]===b&&a[1](c)})}function f(b,c){var d,e=(n?"parentFlash="+t+"&childFlash=_MessengerChildFlash_"+a.now()+"&":"")+"domain="+document.domain;a.isString(b)?(d=b,b={}):d=b.src,b.src=d+(d.indexOf("?")>-1?"&":"?")+e;var f=l.create("<iframe>",b);return f.setAttribute("width",1),f.setAttribute("height",1),l.get(c||"body").appendChild(f)}function g(a){var b=a.src,c=/childFlash=([^&]+)/;if(b){var d=b.match(c);if(d&&d[1])return d[1];throw"iframe has no flashName param"}}function h(){return!!document.domain.match(/^taobao\.(com|net)/)}var i,j=window,k=a.namespace("TBC.Messenger"),l=a.DOM,m=(a.Event,a.UA,a.JSON),n=(document.domain,"undefined"==typeof postMessage||!j.addEventListener),o=-1===location.host.indexOf("daily")&&-1===location.host.indexOf("net"),p="http://"+(o?"g.tbcdn.cn":"g.assets.daily.taobao.net"),q="1.4.4",r=parseFloat(q)?p+"/tbc/umpp/"+q+"/flash-post-message.swf":"flash-post-message.swf",s=[],t="_MessengerFlash_"+a.now();return(!h()||n)&&(n?(a.version>1.3&&a.config({modules:{flash:{alias:["gallery/flash/1.0/"]}}}),a.use(parseFloat(a.version,10)>1.2?"swf":"flash",function(a,b){window._Messenger_Flash_PostMessage=function(a,b){var c=b.type,d=b.msg;"message"==c&&d&&e(d.type,d.content)};var c={src:r,attrs:{width:1,height:1,style:"position:absolute;top:0"},params:{flashVars:{jsentry:"_Messenger_Flash_PostMessage",swfid:"J_MessengerFlashPostMessage",name:t},allowscriptaccess:"always"}};b&&parseFloat(a.version,10)>1.2?i=new b(c):a.Flash&&a.Flash.add&&a.Flash.add("#J_FlashPostMessageContainer",c,function(a){i=a.swf})})):j.addEventListener("message",function(b){var c=b.data;if(c&&a.isString(c))try{var d=m.parse(c);e(d.type,d.content)}catch(f){}},!1)),a.mix(k,{register:b,unregister:c,send:d,createIframe:f,fire:e,flashName:t})},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.4/mods/getNick",function(a){var b=a.namespace("TBC.umpp");return b.getNick=function(b){var c=a.Cookie.get("tracknick")||a.Cookie.get("lgc");return b?encodeURIComponent(unescape(c).replace(/\\u/g,"%u")):c}},{requires:["cookie"]}),KISSY.add("tbc/umpp/1.4.4/mods/trinity",function(a){function b(a,b,c){this.nick=a||"umpp-guest",this.swfurl=b,this.evs=c,this._init()}var c=a.DOM,d=(a.JSON,a.namespace("TBC.umpp")),e="UM_",f=window,g="J_UmppUserContainer",h="_umpp_trinity_",i=b.prototype;return i._init=function(){var b=this,d={src:b.swfurl,attrs:{width:1,height:1},params:{flashVars:{jsentry:h,swfid:e+b.nick+a.now(),group:b.nick},allowscriptaccess:"always"}};f[h]=function(a,c){var d=c.type,e=c.data,f=b.evs,g=f[d];g&&g.call(b,"message"===d?e:null)},a.use(parseFloat(a.version,10)>1.2?"swf":"flash",function(a,e){e&&parseFloat(a.version,10)>1.2?b.swf=new e(d):a.Flash&&a.Flash.add&&(c.get("#"+g)||document.body.appendChild(c.create('<div id="'+g+'" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px"></div>')),a.Flash.add("#"+g,d,function(a){b.swf=a.swf}))})},i.fire=function(a,b){return this.swf.callSWF?this.swf.callSWF("fire",[a,b]):(this.swf.fire(a,b),void 0)},i.destroy=function(){var a=this;try{a.swf.destroy?a.swf.destroy():c.remove("#"+g),delete f[h]}catch(b){}},d.Trinity=b},{requires:["dom","json"]}),KISSY.add("tbc/umpp/1.4.4/mods/initGuest",function(a){function b(b,f,g){return e._guestTimer=setTimeout(function(){a.getScript(parseFloat(c)?f+"/tbc/umpp/"+c+"/guest-min.js":"guest.js",function(){parseFloat(a.version,10)>1.1&&a.use(parseFloat(c)?"tbc/umpp/"+c+"/guest":"tbc/umpp/guest")})},d),a.mix(e,{isOnline:b,cdnPath:f,Trinity:g}),e}var c="1.4.4",d=18e4,e=a.namespace("TBC.umpp");return a.mix(e,{register:function(){},send:function(){},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),this._guestTimer&&(clearTimeout(this._guestTimer),this._guestTimer=null)}}),e.initGuest=b}),KISSY.add("tbc/umpp/1.4.4/mods/initUser",function(a){function b(a){m.get("#"+o)||n.createIframe({src:a,id:o,frameborder:0,scrolling:"no"})}function c(b){a.isArray(b)&&b.length&&a.each(b,function(a){"1063"==a.t1&&s.trinity.fire({content:[a],identity:[s.nick,a.t1,"1"].join("-")})})}function d(){n.register("umppready",function(){k=!0,f("master"),f("join")}),n.register("umppdata",function(a){s.notify(a,!0),c(a)})}function e(b,c){if(!c)return!1;var d=c.body,e=d.content;if(a.isObject(d))if("-"===d.identity)a.each(e,function(b){a.each(s._Events,function(a){a&&b.t1==a[0]&&a[1](b)})});else if(p===d.type)if(i){var g=e[0],h=e[1];"umpp-store-get"===g?s.getItem(h,function(a){b.fire.call(b,{type:p,content:[h,a]},c.from)}):"umpp-store-remove"===g?s.removeItem.call(s,h):"umpp-store-set"===g&&s.setItem.apply(s,h)}else{var e=d.content;n.fire("umpp-store-get-"+e[0],e[1])}else if(q===d.type){if(!d.includeSelf&&c.from===c.to)return!1;f("message",d.content)}}function f(b,c){a.each(s._SwfEvents,function(a){a&&b===a[0]&&(a[1](c),"message"!==b&&(a[0]=b+"_ed"))})}function g(a,c,g,h){s.trinity=new a(c,g,{master:function(){i=!0,d(),b(h),k&&f("master")},join:function(){j=!0,(i&&k||!i)&&f("join")},message:function(a){e(this,a)}})}function h(a,b,c,d){var e="http://mpp."+(a?"taobao.com":"daily.taobao.net:8080")+"/ajaxconn2.html?appId="+r,f=parseFloat(l)?b+"/tbc/umpp/1.4.2/trinity.swf":"trinity.swf";return s.nick=c,g(d,c,f,e),s}var i,j,k,l="1.4.4",m=a.DOM,n=a.TBC.Messenger,o="J_Um_Iframe",p="_trinity_notify_private",q="_trinity_notify_public",r=-1===location.host.indexOf("metting.wangwang")?1064:1065,s=a.namespace("TBC.umpp");return a.mix(s,{_Events:[],_SwfEvents:[],_StoreCache:{},_storeData:function(a,b){i&&(this._StoreCache[a]=b)},_removeData:function(a){i&&this._StoreCache[a]&&delete this._StoreCache[a]},on:function(a,b){return(i&&k||!i&&j)&&("master"===a&&i||"join"===a&&j)?(b(),!0):this._SwfEvents.push([a,b])-1},off:function(b){return a.isNumber(b)?this._SwfEvents[b]=null:void 0},register:function(a,b,c){var d=this,e=function(e,f){b(e,f),c?d._storeData(a,e):d.removeItem(a)};return d.getItem(a,function(a){a&&e(a,!0)}),d._Events.push([a,e])-1},unregister:function(a){return this._Events[a]=null},send:function(a,b){return i?n.send.call(null,a,b,o):(this.trinity&&this.trinity.fire({type:p,content:[a,b]},"_"+this.nick),void 0)},notify:function(a,b){return this.trinity.fire({type:q,content:a,includeSelf:b,identity:"-"})},setItem:function(a,b){var c=this;c.on("join",function(){c._storeData(a,b),c.send("umpp-store-set",[a,b])})},getItem:function(a,b){var c=this,d=this._StoreCache[a];i&&d?b(d):c.on("join",function(){var d=n.register("umpp-store-get-"+a,function(e){n.unregister(d),c._storeData(a,e),b(e)});c.send("umpp-store-get",a)})},removeItem:function(a){var b=this;b.on("join",function(){b._removeData(a),b.send("umpp-store-remove",a)})},clear:function(a){return this.send("clearTMsg",a)},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),m.remove("#"+o),i=void 0,j=void 0,k=void 0,this._StoreCache={}}}),s.initUser=h},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.4/index",function(a){function b(){var b,d=a.Cookie,e=-1===location.host.indexOf("daily"),f=d.get("_l_g_")||d.get("lgc"),g="http://g."+(e?"tbcdn.cn":"assets.daily.taobao.net"),h=c._Events,i=c._SwfEvents;return b=f?c.initUser(e,g,c.getNick(!0),c.Trinity):c.initGuest(e,g,c.Trinity),h&&a.mix(b,{_Events:h}),i&&a.mix(b,{_SwfEvents:i}),a.mix(c,b)}a.version>=1.4&&a.config({modules:{ajax:{alias:["io"]},flash:{alias:["gallery/flash/1.0/"]}}});var c=a.namespace("TBC.umpp");return c.init=b,b()},{requires:["core","tbc/umpp/1.4.4/mods/messenger","tbc/umpp/1.4.4/mods/getNick","tbc/umpp/1.4.4/mods/trinity","tbc/umpp/1.4.4/mods/initGuest","tbc/umpp/1.4.4/mods/initUser"]});/*! tmsg 2014-02-18 */
KISSY.add("tbc/tmsg/2.2.6/mods/core",function(a){var b=a.DOM;a.Event;var c=a.namespace("TMsg",!0),d=window,e=!~location.host.indexOf("daily.taobao.net"),f="tbc/tmsg/2.2.6/plugin/";return a.mix(c,{tag:{isStrongListClosed:!1,strongList:!1,isStrongMsgClosed:!1,strongMsg:!1,event:{base:!0,overview:!0,detailsPanel:!0,strongList:!0,strongNotice:!0}},event:{},plugin:{},isIE6:d.ActiveXObject&&!d.XMLHttpRequest,isKS16:!(parseFloat(a.version,10)>1.1),isDebug:!!~location.search.indexOf("ks-debug"),isOnline:e,cdnHost:e?"http://g.tbcdn.cn/":"http://g.assets.daily.taobao.net/",serverHost:e?"taobao.com":"daily.taobao.net",sm:{init:function(){window.UA_Opt&&window.ua||(window.UA_Opt=window.UA_Opt||{LogVal:"ua",MaxMCLog:3,MaxMPLog:3,MaxKSLog:3,Token:(new Date).getTime()+":"+Math.random(),SendMethod:8,Flag:14222},window.ua="",a.getScript("http://acjs.aliyun.com/actionlog/js/ua.js",function(){try{UA_Opt.reload()}catch(a){}},"GBK"))},ua:function(){var b=window.ua;return UA_Opt.Token=a.now()+":"+Math.random(),UA_Opt.reload(),b}},use:function(b,d){var e=[b],g=b+"-min.js";a.getScript(c.cdnHost+f+g,function(){c.isKS16?d&&d():a.use(f+e.join(","+f),function(){d&&d()})})},ajax:function(b,c,d){var e={t:a.now(),_input_charset:"utf-8"};a.IO.jsonp(b,a.merge(e,c),function(a){d&&d(a)})},deal:function(b,d){"string"==typeof b&&(b=a.JSON.parse(b)),b.status==d.success.code?d.success.callback&&d.success.callback(b):b.status==d.noLogin.code?d.noLogin.callback?d.noLogin.callback(b):c.error.noLogin():d.error.callback&&d.error.callback(b)},error:{noLogin:function(){var d=b.get("#J_Tmsg"),e=b.get(".J_TmsgList",d),f=b.query(".tmsg_panel",d);b.get(".J_TmsgOverview",d),b.html(e,a.substitute(c.temps.overview.no_login,{loginUrl:c.apis.login+encodeURIComponent(location.href)})),a.each(f,function(a){b.attr(a,"style","")}),b.show(b.get(".J_TmsgBody",d))},replyError:function(c,d){var e='<div class="tmsg-poptip J_ReplyErrorTips">   <span class="tmsg-poptip-arrow tmsg-poptip-arrow-left"><em>\u25c6</em><i>\u25c6</i></span>{con}</div>',f=b.create(a.substitute(e,{con:d}));b.insertAfter(f,c);var g=b.offset(c);b.offset(f,{top:g.top-10,left:g.left-210}),a.later(function(){a.one(f).fadeOut(),b.prev(c).focus()},2e3)}},getNick:function(){return c.fromUnicode(a.Cookie.get("_nk_"))},setToken:function(){if(c.token)return!1;var b="http://comment.jianghu."+c.serverHost+"/json/token.htm";a.IO.jsonp(b,{_fetchToken:!0},function(a){c.token=a.token})},getToken:function(b){var d="http://comment.jianghu."+c.serverHost+"/json/token.htm";a.IO.jsonp(d,{_fetchToken:!0},function(a){b&&b(a.token)})},fromUnicode:function(a){return a.replace(/\\u([a-f\d]{4})/gi,function(a,b){return String.fromCharCode(parseInt(b,16))})},sendLog:function(b){b&&((new Image).src="http://gm.mmstat.com/sns."+b+"?cache="+a.now())},sendStatistic:function(b){b&&((new Image).src="http://gm.mmstat.com/sns."+b+"?cache="+a.now())},environment:TB.Global&&TB.Global.version>=2?"New Global":TB.SellerGlobal?"Seller Global":"Old Global",switchGlobal:function(a){switch(c.environment){case"Seller Global":a.seller&&a.seller();break;default:a.common&&a.common()}},renderUrl:function(b){return a.substitute(b,{serverHost:c.serverHost})},substringWithinLimit:function(a,b){if(!a||!b)return"";for(var c=0,d=0,e="",f="...";d<a.length;d++){if(a.charCodeAt(d)>255?c+=2:c++,c>b)return e+f;e+=a.charAt(d)}return a+f},setScroll:function(){var a=b.get("#J_Tmsg"),d=b.get(".J_Tmsg_NormalDetails",a),e=b.parent(d,".tmsg_panel"),f=b.innerHeight(e),g=b.viewportHeight();36>g-f&&c.use("scroll",function(){b.height(d,g-90),new c.Scroll(d)})}}),c}),KISSY.add("tbc/tmsg/2.2.6/mods/const/temps",function(a){var b=TMsg;return b.temps=a.merge({},{base:'<div class="J_TmsgOverview tmsg_overview J_Menu menu" data-fn-name="fn-tmsg">    <div class="J_TmsgHead tmsg_head menu-hd"></div></div>',overview:{head:'<a class="J_TmsgIcon tmsg_icon" href="{messageCenter}" target="_blank"><img class="J_TmsgLoading" style="margin:-5px 5px 0 0;vertical-align:middle" src="http://gtms01.alicdn.com/tps/i1/T1oykcFidbXXXcAos.-13-5.gif" width="13" height="5" /><span class="J_TmsgLogo tmsg_logo iconfont" style="display:none">&#349 <i class="J_TmsgLightSign tmsg_light-sign" style="display:none"></i></span>\u6d88\u606f<span class="J_TmsgSign tmsg_sign tmsg_unread_0"></span></a>',body:'<div class="J_TmsgBody tmsg_body menu-bd">   <div class="J_TmsgOverview_Panel menu-bd-panel tmsg_panel">       <div class="J_TmsgList tmsg_list">           <div class="J_TmsgList_Seller tmsg_list_Seller">               <h3><em>\u5356\u5bb6\u6d88\u606f</em></h3>               <ul class="J_TmsgList_SellerWrap"></ul>           </div>           <div class="J_TmsgList_Buyer tmsg_list_buyer">               <h3><em>\u4e70\u5bb6\u6d88\u606f</em></h3>               <ul class="J_TmsgList_BuyerWrap"></ul>           </div>       </div>       <div class="J_TmsgTools tmsg_tools">           <a class="J_TmsgFeedback tmsg_feedback" href="{feedback}" target="_blank" title="\u610f\u89c1\u53cd\u9988">\u610f\u89c1\u53cd\u9988</a>           <a class="J_TmsgSettings tmsg_sittings" href="{setting}" target="_blank" title="\u8bbe\u7f6e">\u8bbe\u7f6e</a>       </div>   </div></div>',list_item:'<li class="J_TmsgAppItem J_TmsgApp_{appType}" data-type="{appType}">   <a class="J_TmsgListItem tmsg_list-item" href="#" data-num="{unreadNum}" data-type-id="{appId}" data-type="{appType}">       <span class="J_MenuItemMsgIgnore tmsg_list-item_button-ignore">\u5ffd\u7565</span>       <span class="tmsg_list-item_content"><b class="tmsg_list-item_count">{unreadNum}</b>{appName}</span>   </a></li>',no_login:'<p class="tmsg_error_nologin">\u767b\u5f55\u5df2\u5931\u6548\uff0c\u8bf7<a href="{loginUrl}">\u91cd\u65b0\u767b\u5f55</a>\uff01</p>'},panels:{base:'<div class="J_TmsgPanels tmsg_panels" style="display:none">   <div class="J_Tmsg_NormalDetailsPanel tmsg_normal-details-panel J_TmsgPanel tmsg_panel">       <div class="J_TmsgTools tmsg_tools">           <a class="J_TmsgBack2List tmsg_back2list J_BackMsgList" href="#">&lt; \u8fd4\u56de</a>           <a class="J_TmsgCenter tmsg_center" href="{messageCenter}" target="_blank" title="\u6d88\u606f\u4e2d\u5fc3">\u6d88\u606f\u4e2d\u5fc3</a>           <a class="J_TmsgSettings tmsg_sittings" href="{setting}" target="_blank" title="\u8bbe\u7f6e">\u8bbe\u7f6e</a>       </div>       <div class="J_Tmsg_NormalDetails"></div>   </div>   <div class="J_Tmsg_StrongListPanel tmsg_strong-list-panel J_TmsgPanel tmsg_panel">       <ul class="J_Tmsg_StrongList tmsg_list"></ul>       <a class="J_TmsgClosePanel tmsg_close-panel" title="\u5173\u95ed">\u5173\u95ed</a>   </div>   <div class="J_Tmsg_StrongDetailsPanel tmsg_strong-details-panel J_TmsgPanel tmsg_panel">       <div class="J_Tmsg_StrongDetails"></div>       <div class="J_Tmsg_StrongDetails_Page tms_strong-details_page"></div>       <a class="J_TmsgClosePanel tmsg_close-panel" title="\u5173\u95ed">\u5173\u95ed</a>   </div></div>',strong_item:'<div class="J_TmsgStrongItem J_TmsgStrongItem_{catName} tmsg_strong-item" data-msg-id="{msgId}" data-num="{catNum}" data-type="{catName}">   <a class="tmsg_strong-item_avatar" href="{oLink}" target="_blank">       <img src="{oAvatar}" width="30" height="30" alt="{oName}" />   </a>   <div class="tmsg_strong-item_content">       <p class="tmsg_strong-item_content_text">           <a href="{oLink}" target="_blank">{oName}</a> : {msgText}       </p>       <p class="J_Tmsg_StrongNoticeItemBanner tmsg_strong-item_content_banner">           <a href="{msgLink}" target="_blank"><img src="{msgBanner}" width="310" height="60" /></a>       </p>   </div></div>',strong_page:'<span class="J_Tmsg_Page_CurrentNum" style="display:none">1</span><span class="J_Tmsg_Page_TotalNum">{totalNum}</span>\u6761\u672a\u8bfb\u6d88\u606f<a class="J_Tmsg_Page_Next tmsg_page_next">\u4e0b\u4e00\u6761</a>',check_more:'<p class="tmsg_button_check-more"><a href="{appLink}" target="_blank">\u67e5\u770b\u66f4\u591a</a></p>'},defaultList:{buyer:'<li><a href="http://msg.{serverHost}/message/view_message.htm?tab=service&scm=1217.100.0.201" target="_blank">\u670d\u52a1\u901a\u77e5</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=markdown&scm=1217.100.0.202" target="_blank">\u964d\u4ef7\u63d0\u9192</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=logisbus&scm=1217.100.0.203" target="_blank">\u7269\u6d41\u53d8\u5316</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=shopping&scm=1217.100.0.204" target="_blank">\u8d2d\u7269\u63d0\u9192</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=comment&scm=1217.100.0.205" target="_blank">\u8bc4\u8bba</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=atme&scm=1217.100.0.206" target="_blank">\u63d0\u5230\u6211</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=letter&scm=1217.100.0.208" target="_blank">\u79c1\u4fe1</a></li><li><a href="http://msg.{serverHost}/message/view_message.htm?tab=inform&scm=1217.100.0.209" target="_blank">\u4e92\u52a8\u63d0\u9192</a></li>',seller:'<li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=trade&scm=1217.100.0.301" target="_blank">\u4ea4\u6613\u63d0\u9192</a></li><li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=rule&scm=1217.100.0.302" target="_blank">\u89c4\u5219\u901a\u77e5</a></li><li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=services&scm=1217.100.0.303" target="_blank">\u5e94\u7528\u63d0\u793a</a></li><li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=biz&scm=1217.100.0.304" target="_blank">\u62db\u5546\u63d0\u9192</a></li><li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=act&scm=1217.100.0.305" target="_blank">\u6d3b\u52a8\u901a\u77e5</a></li><li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=services&scm=1217.100.0.306" target="_blank">\u670d\u52a1\u4fe1\u606f</a></li><li><a href="http://msg.{serverHost}/seller/seller_message.htm?tab=sec&scm=1217.100.0.307" target="_blank">\u5b89\u5168\u63d0\u9192</a></li>'}}),b},{requires:["tbc/tmsg/2.2.6/mods/core"]}),KISSY.add("tbc/tmsg/2.2.6/mods/const/apis",function(a){var b=TMsg;return b.apis=a.merge({},{buyerDetails:b.renderUrl("http://msg.{serverHost}/message/message_list.htm"),sellerDetails:b.renderUrl("http://msg.{serverHost}/message/seller_messageAjax.htm"),ignoreURL:b.renderUrl("http://msg.{serverHost}/message/ignore_message.htm"),loadingImg:"http://img03.taobaocdn.com/tps/i3/T1HLdLXctlXXXXXXXX-16-16.gif",styleSheet:b.cdnHost+"tbc/tmsg/"+"2.2.6"+"/content-min.css",strongMsg:b.renderUrl("http://msg.{serverHost}/message/popupmsg_list.htm"),readStrongMsg:b.renderUrl("http://msg.{serverHost}/message/hidden_popupMsg.htm"),buyerMsgCenter:b.renderUrl("http://msg.{serverHost}/message/view_message.htm?scm=1217.100.0.101"),sellerMsgCenter:b.renderUrl("http://msg.{serverHost}/seller/seller_message.htm?scm=1217.100.0.101"),buyerMsgSetting:b.renderUrl("http://msg.{serverHost}/message/message_set.htm?scm=1217.100.0.102"),sellerMsgSetting:b.renderUrl("http://msg.{serverHost}/seller/message_set.htm?scm=1217.100.0.102"),buyerMsgFeedback:"http://ur.taobao.com/survey/view.htm?id=1990",sellerMsgFeedback:"http://ur.taobao.com/survey/view.htm?id=1990",login:b.renderUrl("https://login.{serverHost}/member/login.jhtml?f=top&redirectURL=")}),b},{requires:["tbc/tmsg/2.2.6/mods/core"]}),KISSY.add("tbc/tmsg/2.2.6/mods/const/logs",function(a){var b=TMsg;return b.logs=a.merge({},{hover:{enter:"21.1"},click:{service:"21.11",markdown:"21.12",logisbus:"21.13",shopping:"21.14",comment:"21.15",letter:"21.18",inform:"21.19",fans:"21.17",trade:"21.21",rule:"21.22",app:"21.23",biz:"21.24",act:"21.25",services:"21.26",sec:"21.27"},ignore:{service:"21.31",markdown:"21.32",logisbus:"21.33",shopping:"21.34",comment:"21.35",letter:"21.38",inform:"21.39",fans:"21.37",trade:"21.41",rule:"21.42",app:"21.43",biz:"21.44",act:"21.45",services:"21.46",sec:"21.47"}}),b},{requires:["tbc/tmsg/2.2.6/mods/core"]}),KISSY.add("tbc/tmsg/2.2.6/mods/const/cats",function(a){var b=TMsg;return b.cats=a.merge({},{buyer:{service:{name:"\u4e0e\u4f60\u76f8\u5173\u7684\u670d\u52a1\u901a\u77e5",link:"http://msg.{serverHost}/message/view_message.htm?tab=service"},markdown:{name:"\u4f60\u8d2d\u7269\u8f66\u6709\u5b9d\u8d1d\u964d\u4ef7\u5566",link:"http://msg.{serverHost}/message/view_message.htm?tab=markdown"},logisbus:{name:"\u4f60\u4e70\u7684\u5b9d\u8d1d\u7269\u6d41\u6709\u53d8\u5316",link:"http://msg.{serverHost}/message/view_message.htm?tab=logisbus"},shopping:{name:"\u4f60\u6709\u7ea2\u5305\u548c\u91d1\u5e01\u53ef\u9886\u53d6",link:"http://msg.{serverHost}/message/view_message.htm?tab=shopping"},comment:{name:"\u6709\u4eba\u8bc4\u8bba\u4f60\u7684\u5206\u4eab\u5566",link:"http://msg.{serverHost}/message/view_message.htm?tab=comment"},atme:{name:"\u6709\u4eba\u5206\u4eab\u65f6\u63d0\u5230\u4f60\u5566",link:"http://msg.{serverHost}/message/view_message.htm?tab=atme"},letter:{name:"\u6709\u4eba\u6084\u6084\u7ed9\u4f60\u53d1\u79c1\u4fe1",link:"http://msg.{serverHost}/message/view_message.htm?tab=letter"},inform:{name:"\u6709\u4eba\u548c\u4f60\u4e92\u52a8\u4e86\u54e6",link:"http://msg.{serverHost}/message/view_message.htm?tab=inform"},fans:{name:"\u4f60\u53c8\u6709\u65b0\u7684\u7c89\u4e1d\u5566",link:"http://msg.{serverHost}/message/view_message.htm"}},seller:{trade:{name:"\u4ea4\u6613\u63d0\u9192",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=trade"},rule:{name:"\u89c4\u5219\u901a\u77e5",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=rule"},app:{name:"\u5e94\u7528\u63d0\u793a",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=services"},biz:{name:"\u62db\u5546\u63d0\u9192",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=biz"},act:{name:"\u6d3b\u52a8\u901a\u77e5",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=act"},services:{name:"\u670d\u52a1\u4fe1\u606f",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=services"},sec:{name:"\u5b89\u5168\u63d0\u9192",link:"http://msg.{serverHost}/seller/seller_message.htm?tab=sec"}}}),b},{requires:["tbc/tmsg/2.2.6/mods/core"]}),KISSY.add("tbc/tmsg/2.2.6/mods/base",function(a){var b,c,d,e=a.IO,f=a.DOM,g=a.JSON,h=a.Event,i=TMsg,j=a.TBC.umpp,k={},l=!1,m=!(!i.isKS16&&!i.isIE6);return i.base={dataFormatting:function(b){return a.isString(b)?g.parse(b):a.isObject(b)?b.content?a.isString(b.content)?g.parse(b.content):a.isObject(b.content)?b.content:void 0:[]:b},registUmpp:function(){var e,f,g=this,h=3,l="tmsgexpiretime";d=j.register("1064",function(c,d){f=g.dataFormatting(c),!d&&i.sendLog("21.50"),a.isArray(f)?(b=f,g.updateNewMsgHint(f),!m&&g.updateNewMsgList(f)):(k=a.merge(k,f),k.type0&&function(){g.updateNewMsgHint(k.type0),!m&&g.updateNewMsgList(k.type0)}(),k.type2&&function(){g.loadStrongNotice(k.type2)}(),k.type1&&function(){!m&&!i.tag.isStrongListClosed&&g.loadStrongList(k.type1)}()),e&&!d&&j.setItem(l,a.now())},!0),c=j.on("master",function(){e=!0,j.getItem(l,function(b){(!b||a.now()-1*b>=1e3*60*60*h)&&g.fetchMsg()})})},fetchMsg:function(){var a="http://msg."+i.serverHost+"/message/un_read_num.htm";e.jsonp(a,function(a){j.notify([{t1:"1064",content:a.content}],!0),j.setItem("1064",a.content)})},init:function(){var a=this;a.render(),a.registUmpp()},destroy:function(){a.mix(window.TMsg,{tag:{isStrongListClosed:!1,strongList:!1,isStrongMsgClosed:!1,strongMsg:!1,event:{base:!0,overview:!0,detailsPanel:!0,strongList:!0,strongNotice:!0}}}),!!k&&(k={}),!!b&&(b=null),j.unregister(d),j.off(c)},render:function(){var a=this;a.renderTmsgBase(),a.renderTmsgOverview(),!m&&a.renderTmsgPanelsBase()},renderTmsgBase:function(){var a=f.get("#J_Tmsg");if(m&&(f.attr(a,"title","\u6d88\u606f\u4e2d\u5fc3"),f.addClass(a,"tmsg_low-environment-global")),"New Global"!==i.environment){switch(i.environment){case"Old Global":f.addClass(a,"J_TmsgOld tmsg_old");break;case"Seller Global":f.addClass(a,"J_TmsgSeller tmsg_seller")}f.html(a,i.temps.base)}},renderTmsgPanelsBase:function(){var b=this,c=f.get("#J_Tmsg"),d=!("Seller Global"!=i.environment);f.append(f.create(a.substitute(i.temps.panels.base,{setting:d?i.apis.sellerMsgSetting:i.apis.buyerMsgSetting,messageCenter:d?i.apis.sellerMsgCenter:i.apis.buyerMsgCenter})),c),i.tag.event.base&&b.bindTmsgBaseEvent()},bindTmsgBaseEvent:function(){i.tag.event.base=!1;var b=this,c=f.get("#J_Tmsg");h.delegate(c,"click",".J_MenuItemMsgIgnore",function(a){a.preventDefault();var c=a.target,d=f.parent(c,".J_TmsgListItem"),e=f.attr(d,"data-type");return i.sendLog(i.logs.ignore[e]),i.getToken(function(a){i.ajax(i.apis.ignoreURL,{"do":!1,tab:e,m_token:a},function(a){i.deal(a,{noLogin:{code:"-1"},success:{code:"0",callback:function(){b.refreshOverview(d)}},error:function(){}})})}),!1}),h.delegate(c,"click",".J_TmsgListItem",function(d){d.preventDefault();var e=d.target,g=f.hasClass(e,"J_TmsgListItem")?e:f.parent(e,".J_TmsgListItem"),h=f.attr(g,"data-type-id"),j=f.attr(g,"data-type"),k=parseInt(f.attr(g,"data-num"),10);i.sendLog(i.logs.click[j]);var m=h>50?"seller":a.inArray(h,["6","7","8","9"])?"service":j,n=h>50?i.apis.sellerDetails:i.apis.buyerDetails;i.ajax(n,{tab:j,page:1,size:Math.min(k,10)},function(d){i.deal(d,{noLogin:{code:"-1"},success:{code:"0",callback:function(d){i.use(m,function(){var e=f.get(".J_TmsgPanels",c),h=f.get(".J_TmsgOverview",c);f.addClass(h,"menu-active"),f.removeClass(h,"menu-hover"),a.getScript(i.apis.styleSheet,{success:function(){var c=f.get("#J_Tmsg"),n=f.get(".J_Tmsg_NormalDetailsPanel",c),o=f.get(".J_TmsgBody",h),p=f.get(".J_Tmsg_NormalDetails",n),q=f.get(".J_Tmsg_StrongListPanel",e);f.html(p,""),i[m]&&i[m].init(d.list,function(){if(i.sm.init(),k>10){var c=a.merge(i.cats.buyer,i.cats.seller),d=f.create(a.substitute(i.temps.panels.check_more,{link:c[j].link}));f.append(d,p)}f.hide(o),f.hide(q),b.refreshOverview(g),f.show(n),i.tag.event.detailsPanel&&b.bindTmsgDetailsPanelEvent(n),l=!0,i.setScroll()})}})})}},error:function(){}})})})},bindTmsgDetailsPanelEvent:function(a){i.tag.event.detailsPanel=!1;var b=f.get("#J_Tmsg");h.delegate(a,"click",".J_TmsgBack2List",function(c){c.preventDefault();var d=f.get(".J_TmsgOverview",b),e=f.get(".J_TmsgBody",d);f.removeClass(d,"menu-active"),f.hide(a),i.switchGlobal({common:function(){f.addClass(d,"menu-hover"),f.show(e)},seller:function(){f.attr(e,"style","")}})}),!l&&h.delegate(document,"click","body",function(a){var c=a.target,d="none"==f.css(".J_Tmsg_NormalDetailsPanel","display"),e=!f.parent(c,".J_Tmsg_NormalDetailsPanel");!d&&e&&function(){var a=f.get(".J_TmsgOverview",b),c=f.get(".J_TmsgBody",a);f.addClass(a,"menu"),f.removeClass(a,"menu-active"),f.attr(c,"style",""),f.hide(".J_Tmsg_NormalDetailsPanel")}()})},renderTmsgOverview:function(){var b=this,c=f.get("#J_Tmsg"),d=f.get(".J_TmsgHead",c),e=f.get(".J_TmsgOverview",c),g=!("Seller Global"!=i.environment);f.html(d,a.substitute(i.temps.overview.head,{messageCenter:g?i.apis.sellerMsgCenter:i.apis.buyerMsgCenter}),!0),!i.isIE6&&function(){f.append(f.create("<i><em></em><span></span></i>"),d)}(),!m&&function(){f.append(f.create(a.substitute(i.temps.overview.body,{setting:g?i.apis.sellerMsgSetting:i.apis.buyerMsgSetting,feedback:g?i.apis.sellerMsgFeedback:i.apis.buyerMsgFeedback})),e),b.renderTmsgDefaultList(),i.tag.event.overview&&b.bindTmsgOverviewEvent()}()},renderTmsgDefaultList:function(){var b=f.get("#J_Tmsg"),c=f.get(".J_TmsgList_Buyer",b),d=f.get(".J_TmsgList_BuyerWrap",b),e=f.get(".J_TmsgList_Seller",b),g=f.get(".J_TmsgList_SellerWrap",b);i.switchGlobal({common:function(){f.hide(e),f.hide(f.siblings(d,"h3")[0]),f.html(d,a.substitute(i.temps.defaultList.buyer,{serverHost:i.serverHost})),f.show(c)},seller:function(){f.hide(c),f.hide(f.siblings(g,"h3")[0]),f.html(g,a.substitute(i.temps.defaultList.seller,{serverHost:i.serverHost})),f.show(e)}})},refreshOverview:function(a,b){var c=this;c.refreshIcon(a),c.refreshListPanel(a,b)},refreshIcon:function(a){var b=f.get("#J_Tmsg"),c=parseInt(f.attr(a,"data-num"),10),d=f.get(".J_TmsgOverview",b),e=f.get(".J_TmsgIcon",d),g=f.get(".J_TmsgLogo",d),h=f.get(".J_TmsgSign",d),i=parseInt(f.html(h),10),j=i-c>0?i-c:0,k=!j;f.html(h,j),f.attr(h,"class",""),f.addClass(h,"J_TmsgSign tmsg_sign tmsg_unread_"+j),k&&function(){f.removeClass(g,"tmsg_logo_active"),f.removeClass(g,"tmsg_logo_updata_icon")}(),f.attr(e,"class","J_TmsgIcon tmsg_icon"),0==j||(10>j&&j>0?f.addClass(e,"tmsg_icon_padding-level-1"):j>=10&&20>=j?f.addClass(e,"tmsg_icon_padding-level-2"):f.addClass(e,"tmsg_icon_padding-level-3"))},refreshListPanel:function(b,c){var d=this,e=f.get("#J_Tmsg"),g=parseInt(f.attr(b,"data-num"),10),h=f.attr(b,"data-type"),i=f.query(".J_TmsgApp_"+h,e);"1"==g?a.each(i,function(a){var b=f.get(".tmsg_list-item_count",a),e=parseInt(f.html(b),10);e-1>0?f.html(b,e-1):(d.refreshXmpp(a),d.refreshList(a,c))}):(d.refreshXmpp(b),d.refreshList(b,c))},updateNewMsgHint:function(b){var c=this;f.hide(".J_TmsgLoading"),f.show(".J_TmsgLogo"),i.switchGlobal({common:function(){var d,e=0,g=["inform"],h=!0;i.isIE6&&f.style(".J_TmsgIcon",{padding:"0px 0px 0px 0px! important"}),1==b.length&&a.inArray(b[0].url,g)&&(h=!1),a.each(b,function(a){e+=parseInt(a.num,10)}),!e&&(d=!0),c.updateNewMsgSign(e,h,d)},seller:function(){var d,e=0,f=!0;a.each(b,function(a){a.type>50&&(e+=parseInt(a.num,10))}),!e&&(d=!0),c.updateNewMsgSign(e,f,d)}})},updateNewMsgSign:function(a,b,c){var d=this,e=f.get("#J_Tmsg"),g=f.get(".J_TmsgLogo",e),h=f.get(".J_TmsgSign",e);return c?(f.removeClass(g,"tmsg_logo_active"),f.removeClass(g,"tmsg_logo_updata_icon"),f.html(h,"0"),f.attr(h,"class","J_TmsgSign tmsg_sign tmsg_unread_0"),d.updateNewMsgIcon(0),!1):(b?(f.addClass(g,"tmsg_logo_active"),f.html(h,a),f.attr(h,"class","J_TmsgSign tmsg_sign tmsg_unread_"+a),d.updateNewMsgIcon(a)):f.addClass(g,"tmsg_logo_updata_icon"),void 0)},updateNewMsgIcon:function(a){var b=f.get("#J_Tmsg"),c=f.get(".J_TmsgIcon",b);0==a?(f.removeClass(c,"tmsg_icon_padding-level-1"),f.removeClass(c,"tmsg_icon_padding-level-2"),f.removeClass(c,"tmsg_icon_padding-level-3")):a>0&&10>a?f.addClass(c,"tmsg_icon_padding-level-1"):a>=10&&20>=a?f.addClass(c,"tmsg_icon_padding-level-2"):f.addClass(c,"tmsg_icon_padding-level-3")},updateNewMsgList:function(b){var c=this,d=f.get("#J_Tmsg"),e=0,g=0,h=0,j=f.get(".J_TmsgList_Buyer",d),k=f.get(".J_TmsgList_Seller",d),l=f.get(".J_TmsgList_BuyerWrap",d),m=f.get(".J_TmsgList_SellerWrap",d);a.each(b,function(a){h+=parseInt(a.num,10),parseInt(a.type,10)<50?e+=parseInt(a.num,10):g+=parseInt(a.num,10)}),i.switchGlobal({common:function(){f.html(l,""),f.html(m,""),h?a.each(b,function(a){var b=c.renderListItem(a);e&&parseInt(a.type,10)<50&&(g?f.show(f.siblings(l,"h3")[0]):(f.hide(f.siblings(l,"h3")[0]),f.hide(f.siblings(m,"h3")[0])),f.append(b,l),f.show(j)),g&&parseInt(a.type,10)>50&&(f.append(b,m),f.show(f.siblings(m,"h3")[0]),f.show(k),e||(f.hide(j),!!f.get(".J_Tmsg_StrongAct")&&f.remove(".J_Tmsg_StrongAct")))}):(c.renderTmsgDefaultList(),!!f.get(".J_Tmsg_StrongAct")&&f.remove(".J_Tmsg_StrongAct"))},seller:function(){f.html(m,""),g?a.each(b,function(a){if(parseInt(a.type,10)>50){var b=c.renderListItem(a);f.append(b,m)}}):c.renderTmsgDefaultList()}})},refreshXmpp:function(c){var d=this,e=f.attr(c,"data-type"),g=parseInt(f.attr(c,"data-num"),10);if(a.isArray(b))for(var h=0;h<b.length;h++)e==b[h].url&&function(){b[h].num=0,j.clear(b[h].url)}();else d.resetNormalMsgXmpp(e,["type0","type1"],g)},resetStrongMsgXmpp:function(b){var c=this,d=f.attr(b,"data-type"),e=parseInt(f.attr(b,"data-num"),10);k.type2&&function(){k=a.merge(k,{type2:k.type2-1})}(),c.resetNormalMsgXmpp(d,["type0","type1"],e)},resetNormalMsgXmpp:function(b,c,d){var e=this;a.each(c,function(c){k[c]&&function(){var e;a.each(k[c],function(a){b==a.url&&function(){e=a.num-d>0?a.num-d:0,a.num=e}()})}()}),e.resetUmpp(k)},resetUmpp:function(a){j.setItem("1064",a),j.notify([{t1:"1064",content:a}],!0)},refreshList:function(b,c){var d=this,e=f.get("#J_Tmsg"),g=f.attr(b,"data-type"),h=f.query(".J_TmsgApp_"+g,e);a.each(h,function(b){var c=f.parent(b,".tmsg_list");if(f.remove(b),f.hasClass(c,"J_TmsgList")){var e=f.get(".J_TmsgList_Buyer",c),g=f.get(".J_TmsgList_Seller",c),h=f.get(".J_TmsgList_BuyerWrap",c),j=f.get(".J_TmsgList_SellerWrap",c),k=!f.get(".J_TmsgAppItem",h),l=!f.get(".J_TmsgAppItem",j);k&&l?d.renderTmsgDefaultList():k&&!l?(f.hide(e),f.hide(f.siblings(j,"h3")[0])):l&&!k&&i.switchGlobal({common:function(){f.hide(g),f.hide(f.siblings(h,"h3")[0])},seller:function(){f.html(j,a.substitute(i.temps.defaultList.seller,{serverHost:i.serverHost}))}})}else if(f.hasClass(c,"J_Tmsg_StrongList")){var m=!f.get(".J_TmsgAppItem",c);m&&f.hide(f.parent(c,".J_Tmsg_StrongListPanel"))}});var j=f.get(".J_Tmsg_StrongDetailsPanel",e),k=f.query(".J_TmsgStrongItem_"+g,j);!c&&d.removeTheReadenMessage(k)},bindTmsgOverviewEvent:function(){i.tag.event.overview=!1;var b=this,c=f.get("#J_Tmsg"),d=f.get(".J_TmsgOverview",c);h.delegate(c,"mouseenter",".J_TmsgOverview",function(){var a=f.get(".J_Tmsg_StrongListPanel",c),b=f.get(".J_Tmsg_StrongDetailsPanel",c);f.addClass(d,"J_OverviewHover"),f.hide(a),f.hide(b),i.switchGlobal({common:function(){i.sendLog("21.1")},seller:function(){i.sendLog("21.6")}})}),h.delegate(c,"mouseleave",".J_TmsgOverview",function(){if(f.removeClass(d,"J_OverviewHover"),!f.hasClass(".J_TmsgOverview",".menu-active")){var c=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_StrongListPanel",c),g=f.get(".J_Tmsg_StrongDetailsPanel",c);a.later(function(){b.isStrongPanelAllowed("msg",function(){f.show(g)}),b.isStrongPanelAllowed("list",function(){f.show(e)})},400)}})},loadStrongNotice:function(){var a=this;i.tag.strongMsg=!0,i.getToken(function(b){i.ajax(i.apis.strongMsg,{m_token:b},function(b){i.deal(b,{noLogin:{code:"-1"},success:{code:"0",callback:function(b){k.type2=parseInt(b.totalNum),!!b.list2&&(k.type2+=b.list2.length),!!b.list2&&a.renderStrongAct(b),!b.list2&&f.get(".J_Tmsg_StrongAct")&&f.remove(".J_Tmsg_StrongAct"),!m&&!i.tag.isStrongMsgClosed&&!!b.list&&a.renderStrongNotice(b)}},error:function(){}})})})},renderStrongNotice:function(b){var c=this,d=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_StrongDetails",d),g=f.get(".J_Tmsg_StrongDetailsPanel",d);f.html(e,""),a.each(b.list,function(b){var c=f.create(a.substitute(i.temps.panels.strong_item,{oName:b.origin.name,oLink:b.origin.link,oAvatar:b.origin.avatar,catNum:"1",catName:b.cat.name||"",msgId:b.msg.id,msgLink:b.msg.link,msgText:b.msg.content.text,msgBanner:b.msg.content.banner||""}));if(b.msg.content.banner){var d=f.get(".J_Tmsg_ButtonMore",c);f.hide(d)}else{var g=f.get(".J_Tmsg_StrongNoticeItemBanner",c);f.hide(g)}f.append(c,e)}),c.resetPage(),i.tag.event.strongNotice&&c.bindStrongNoticeEvent(g),c.isStrongPanelAllowed("msg",function(){f.show(g)})},removeTheReadenMessage:function(b){var c=this;a.each(b,function(a){f.remove(a)});var d=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_StrongDetailsPanel",d),g=f.query(".J_TmsgStrongItem",e),h=!1;a.each(g,function(a){"block"==f.css(a,"display")&&(h=!0)}),h||f.show(g[0]),c.resetPage()},dealTheReadenMessage:function(a,b){var c=this,d=f.attr(a,"data-msg-id");i.ajax(i.apis.readStrongMsg,{messageId:d},function(d){i.deal(d,{success:{code:"0",callback:function(){f.addClass(a,"J_Tmsg_ReadenStrongMsg"),c.resetStrongMsgXmpp(a),c.refreshOverview(a,b)}}})})},resetPage:function(){var b=f.get("#J_Tmsg"),c=f.get(".J_Tmsg_StrongDetailsPanel",b),d=f.get(".J_Tmsg_StrongDetails_Page",c),e=f.query(".J_TmsgStrongItem",c),g=e.length;g>1?(f.html(d,a.substitute(i.temps.panels.strong_page,{totalNum:g})),f.show(d)):1==g?f.hide(d):f.hide(c),a.each(e,function(a,b){b&&f.hide(a)})},bindStrongNoticeEvent:function(b){i.tag.event.strongNotice=!1;var c=this,d=f.get("#J_Tmsg");h.delegate(b,"click",".J_TmsgClosePanel",function(a){a.preventDefault(),i.tag.strongMsg=!1,i.tag.isStrongMsgClosed=!0,i.sendLog("21.5");for(var d,e=f.query(".J_TmsgStrongItem",b),g=0;g<e.length;g++)"block"===f.css(e[g],"display")&&(d=e[g]);c.dealTheReadenMessage(d),c.removeTheReadenMessage(f.query(".J_Tmsg_ReadenStrongMsg",b)),f.hide(b),c.isStrongPanelAllowed("list",function(){f.show(".J_Tmsg_StrongListPanel")})}),h.delegate(b,"click",".J_Tmsg_Page_Prev",function(b){if(b.preventDefault(),f.hasClass(b.target,"J_TmsgDisabled"))return!1;var c=b.target,d=f.parent(c,".J_TmsgPanel"),e=f.get(".J_Tmsg_StrongDetails",d),g=f.query(".J_TmsgStrongItem",e),h=f.get(".J_Tmsg_Page_Next",d),i=f.get(".J_Tmsg_Page_CurrentNum",d),j=parseInt(f.html(i),10);a.each(g,function(a){f.hide(a)}),1!==j&&(f.show(g[j-2]),f.html(i,j-1),f.removeClass(h,"J_TmsgDisabled tmsg_page_next-disabled"),1===j-1&&f.addClass(c,"J_TmsgDisabled tmsg_page_prev-disabled"))}),h.delegate(b,"click",".J_Tmsg_Page_Next",function(b){if(b.preventDefault(),f.hasClass(b.target,"J_TmsgDisabled"))return!1;var d=b.target,e=f.parent(d,".J_TmsgPanel"),g=f.get(".J_Tmsg_StrongDetails",e),h=f.query(".J_TmsgStrongItem",g),i=f.get(".J_Tmsg_Page_Prev",e),j=f.get(".J_Tmsg_Page_CurrentNum",e),k=parseInt(f.html(f.get(".J_Tmsg_Page_TotalNum",e)),10),l=parseInt(f.html(j),10);a.each(h,function(a){f.hide(a)}),l!==k&&(f.show(h[l]),f.html(j,l+1),f.removeClass(i,"J_TmsgDisabled tmsg_page_prev-disabled"),l+1===k&&f.addClass(d,"J_TmsgDisabled tmsg_page_next-disabled")),c.dealTheReadenMessage(h[l-1],!0)}),h.delegate(b,"click",".J_TmsgStrongItem",function(a){var b=a.target,d=f.hasClass(b,"tmsg_strong-item")?b:f.parent(a.target,".J_TmsgStrongItem");c.dealTheReadenMessage(d,!0)}),h.delegate(d,"mouseenter",".J_Tmsg_StrongDetailsPanel",function(){i.switchGlobal({common:function(){i.sendLog("21.3")},seller:function(){i.sendLog("21.8")}})})},loadStrongList:function(b){i.tag.strongList=!0;var c=this,d=f.get("#J_Tmsg"),e=0,g=f.get(".J_Tmsg_StrongListPanel",d),h=f.get(".J_Tmsg_StrongList",g);a.each(b,function(a){e+=parseInt(a.num,10)}),f.html(h,""),a.each(b,function(a){i.switchGlobal({common:function(){var b=c.renderListItem(a);f.append(b,h)},seller:function(){a.catId>50&&function(){var b=c.renderListItem(a);f.append(b,h)}()}})}),c.isStrongPanelAllowed("list",function(){f.show(g)}),i.tag.event.strongList&&c.bindStrongListEvent(g)},bindStrongListEvent:function(a){i.tag.event.strongList=!1;var b=f.get("#J_Tmsg");h.delegate(a,"click",".J_TmsgClosePanel",function(b){b.preventDefault(),i.sendLog("21.4"),f.hide(a),i.tag.strongList=!1,i.tag.isStrongListClosed=!0}),h.delegate(b,"mouseenter",".J_Tmsg_StrongListPanel",function(){i.switchGlobal({common:function(){i.sendLog("21.2")},seller:function(){i.sendLog("21.7")}})})},renderListItem:function(b){if("0"==b.num)return"";var c=a.merge(i.cats.buyer,i.cats.seller);return f.create(a.substitute(i.temps.overview.list_item,{appId:b.catId,appName:c[b.url].name,appType:b.url,unreadNum:b.num}))},isStrongPanelAllowed:function(a,b){var c=f.get("#J_Tmsg"),d=f.get(".J_TmsgOverview",c),e=f.get(".J_Tmsg_StrongDetailsPanel",c),g=f.get(".J_Tmsg_StrongListPanel",c),h=f.hasClass(d,"menu-hover")||f.hasClass(d,"menu-active")||f.hasClass(d,"J_OverviewHover"),j=f.get(".J_TmsgStrongItem",e)&&i.tag.strongMsg,k=!f.get(".J_TmsgStrongItem",e),l=!f.get(".J_TmsgListItem",g),m=f.get(".J_Tmsg_StrongAct");"list"!==a||!i.tag.strongList||h||m||j||l?"msg"!==a||!i.tag.strongMsg||h||m||k||(f.hide(g),b&&b()):b&&b()},showList:function(){},switchPage:function(a){window.FP?a.homePage&&a.homePage():a.normalPage&&a.normalPage()},hideNormalStrongPanels:function(){var a=f.get("#J_Tmsg"),b=f.get(".J_Tmsg_StrongDetailsPanel",a),c=f.get(".J_Tmsg_StrongListPanel",a);f.hide(b),f.hide(c)},renderStrongAct:function(a){var b=this;b.hideNormalStrongPanels(),!!f.get(".J_Tmsg_StrongAct")&&f.remove(".J_Tmsg_StrongAct"),i.switchGlobal({common:function(){b.switchPage({homePage:function(){b.renderStrongActPopup(a)},normalPage:function(){b.renderStrongActAnim(a)}})}})},renderStrongActAnim:function(b){var c=this,d=f.get("#J_Tmsg"),e=f.get(".J_TmsgIcon",d);if(b.list2){var g='<a class="J_Tmsg_StrongAct J_Tmsg_RedPacketAnim" href="{link}" data-type="{type}" data-msg-id="{id}" data-num="1" target="_blank">   <img src="http://gtms01.alicdn.com/tps/i1/T1ouIKFjXXXXbPEHPe-35-35.gif" width="35" height="35" title="\u6765\u624b\u673a\u6dd8\u5b9d\uff0c\u6709\u4f60\u7684\u7ea2\u5305\uff01" /></a>';
f.insertAfter(f.create(a.substitute(g,{id:b.list2[0].msg.id,link:b.list2[0].msg.link+"&scm=1217.100.0.401",type:b.list2[0].cat.name})),e)}c.bindStrongActEvent()},renderStrongActPopup:function(b){var c=this,d=f.get("#J_Tmsg"),e=f.get(".J_TmsgPanels",d);if(b.list2){var g='<div class="J_Tmsg_StrongAct J_Tmsg_RedPacketPop tmsg_redpacket-pop" data-type="{type}" data-msg-id="{id}" data-num="1">   <a class="J_Tmsg_RedpacketPop_Main tmsg_redpacket-pop_main" href="{link}" target="_blank">       <img class="tmsg_redpacket-pop_icon" src="{iconSrc}" width="42" height="54" />       {content}   </a>   <a class="J_Tmsg_RedPacketPop_Button_Close tmsg_redpacket-pop_button_close" href="#">\u5173\u95ed</a></div>';f.insertAfter(f.create(a.substitute(g,{id:b.list2[0].msg.id,link:b.list2[0].msg.link+"&scm=1217.100.0.400",type:b.list2[0].cat.name,content:b.list2[0].msg.content.text,iconSrc:b.list2[0].msg.content.banner})),e)}c.bindStrongActEvent()},dealStrongActReaden:function(b,c,d){var e=this;i.ajax(i.apis.readStrongMsg,{messageId:b},function(b){i.deal(b,{success:{code:"0",callback:function(){var b=f.get("#J_Tmsg"),g=f.get(".J_Tmsg_StrongDetailsPanel",b),h=f.get(".J_Tmsg_StrongListPanel",b);k.type2&&function(){k=a.merge(k,{type2:k.type2-1})}(),e.refreshOverview(c),!d&&f.remove(c),a.later(function(){e.isStrongPanelAllowed("msg",function(){f.show(g)}),e.isStrongPanelAllowed("list",function(){f.show(h)})},400)}}})})},bindStrongActEvent:function(){var a=this;h.on(".J_Tmsg_RedPacketAnim","click",function(){var b=f.get(".J_Tmsg_RedPacketAnim"),c=f.attr(b,"data-msg-id");a.dealStrongActReaden(c,b)}),h.on(".J_Tmsg_RedPacketPop_Button_Close","click",function(b){b.preventDefault();var c=f.parent(b.target,".J_Tmsg_StrongAct"),d=f.attr(c,"data-msg-id");i.sendLog("21.51"),a.dealStrongActReaden(d,c)}),h.on(".J_Tmsg_RedpacketPop_Main","click",function(b){var c=f.parent(b.target,".J_Tmsg_StrongAct"),d=f.attr(c,"data-msg-id");a.dealStrongActReaden(d,c,!0)})}},i},{requires:["tbc/tmsg/2.2.6/mods/core"]}),KISSY.add("tbc/tmsg/2.2.6/index",function(a){var b=TMsg.cdnHost+"tbc/tmsg/"+"2.2.6"+"/index-min.css";TMsg.isKS16?a.getScript(b):a.getScript(b,function(){}),TMsg.base&&TMsg.base.init()},{requires:["tbc/tmsg/2.2.6/mods/core","tbc/tmsg/2.2.6/mods/const/temps","tbc/tmsg/2.2.6/mods/const/apis","tbc/tmsg/2.2.6/mods/const/logs","tbc/tmsg/2.2.6/mods/const/cats","tbc/tmsg/2.2.6/mods/base"]});