/*! Ratemanager 2013-08-20 */
!function(a){function b(b,c){var d='<div class="rate-gift-tip"><b class="tip-arrow"></b><b class="tip-arrow-b"></b>{content}</div>',e=f(b);if(e){var g,h=a.one(e).one("td.operate");if(a.each(h.all("a"),function(b){var c=a.one(b).attr("href");0===c.indexOf("http://rate.")&&(g=c)}),g){c=a.substitute(c,{link:g});var i=a.substitute(d,{content:c});h&&h.append(i)}}}function c(b){e||(e=!0,a.ready(function(){h(b.orders,b.giftCheckAPI)}))}var d,e=!1,f=function(b){if(b){d||(d=a.one("#J_BoughtTable").all("TBODY"));for(var c,e=0,f=d.length;f>e;e++)if(c=a.one(d[e]),c.attr("data-orderid")===b)return c}},g=function(b,c){var d=a.filter(c,function(c){var d=!1;return c.items?(a.each(c.items,function(c){a.indexOf(c,b)>-1&&(d=!0)}),d):d});return d},h=function(c,d){var e=[];a.each(c,function(a){a.items&&(e=e.concat(a.items))}),0!==e.length&&(e=a.unique(e),a.io({url:d,data:"itemIds="+e.join(),dataType:"jsonp",timeout:"2.5",success:function(d){if(d&&d.gift){var e,f=d.gift;f&&0!==f.length&&(e=g(f,c),a.each(e,function(a){b(a,"\u0434\ufffd\ufffd\ufffd\ufffd\ufffd\u043d\ufffd")}))}}}))};window.renderRate=c}(KISSY);