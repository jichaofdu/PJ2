var TuiJian=function(container,api,data){var S=KISSY,DOM=S.DOM;var appid2name={'error':'','6007':'boughtitem','18':'boughtitem','44':'boughtitem','6005':'rate_success','13':'rate_success','6378':'item_collect_list','31':'item_collect_list','6379':'shop_collect_list','32':'shop_collect_list','1315':'favorite_collect','15':'favorite_collect','47':'favorite_collect','6676':'favorite_cart','16':'favorite_cart','6377':'favorite_store','12':'favorite_store','pay_success':'pay_success','bought_shop_list':'bought_shop_list','prefer_map_catview':'prefer_map_catview'};function _getURLParam(url,param){var reg=new RegExp("(^|&|\\?)"+param+"=([^&#]*)(#|&|$)"),r;if(r=url.match(reg)){return decodeURI(r[2]);}
return'error';}
function _isWithinViewport(elem){var curElemTop=DOM.offset(elem).top,curScrollTop=DOM.scrollTop(),curViewportTop=DOM.viewportHeight()+curScrollTop;return curElemTop>=curScrollTop&&curElemTop<curViewportTop;}
var self=this;var from_param,jsonp_param;var RegExp1=new RegExp("from");var RegExp2=new RegExp("appid");if(RegExp1.test(api)){from_param=appid2name[_getURLParam(api,'from')];jsonp_param='jsonp';}else if(RegExp2.test(api)){from_param=appid2name[_getURLParam(api,'appid')];jsonp_param='callback';}
this.config={'container':container,'api':api,'from':from_param,'data':data||{},'renderJS':'','gitVersion':'1.0.6','renderData':{}};this.updateConfig=function(){if(!self.config.from){S.log('TuiJian config Error: lost param "appid"!','error');}
self.config.renderJS='http://g.tbcdn.cn/tb/relationrecommendplug/'+self.config.gitVersion+'/v2/templates/'+self.config.from+'.js';if(location.href.indexOf('daily')>-1){self.config.api=self.config.api.replace('taobao.com','daily.taobao.net');self.config.renderJS=self.config.renderJS.replace('g.tbcdn.cn','g.assets.daily.taobao.net');}
if(location.href.indexOf('localhost')>-1||location.host=='127.0.0.1'){self.config.renderJS=self.config.renderJS.replace('g.tbcdn.cn','g.assets.daily.taobao.net');}};this.routeData=function(d){self.config.renderData=d;window['TuiJianCallBack_'+self.config.from]=function(fn){fn(self);};S.getScript(self.config.renderJS);};this.init=function(){self.updateConfig();S.io({type:"get",url:self.config.api,data:self.config.data,complete:self.routeData,dataType:"jsonp",jsonp:jsonp_param});};S.use('datalazyload',function(){var isInView=false;S.each(S.query(self.config.container),function(i){if(_isWithinViewport(i)){isInView=true;}});if(isInView){self.init();}else{S.use('datalazyload',function(){S.DataLazyload(self.config.container,{diff:200}).addCallback(self.config.container,self.init);});}});};