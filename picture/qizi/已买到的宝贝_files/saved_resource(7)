KISSY.add("widget/event_center/index",function(a,b){return a.mix({},b.Target)},{requires:["event"]}),KISSY.add("widget/page_manager/index",function(a,b){return{initMods:function(c,d){a.each(c,function(b){if(a.isPlainObject(b)&&a.isFunction(b.init))try{b.init()}catch(c){a.log(c,"info")}}),d&&b.fire("mainScriptExecuted")}}},{requires:["widget/event_center/index"]}),KISSY.add("widget/yun_mobile_refund/index",function(a,b,c){function d(){var a='<div class="msg24"><p class="attention">\u60a8\u7684\u624b\u673a\u5df2\u7ecf\u5728\u751f\u4ea7\u4e2d\uff0c\u6682\u4e0d\u80fd\u7533\u8bf7\u9000\u6b3e\uff0c\u5982\u6709\u9700\u8981\u8bf7\u4e0e\u5356\u5bb6\u8054\u7cfb</p></div>';return new c.Dialog({elCls:"tm-dialog-blue yun-moblie-refund",bodyContent:a,width:520,closable:!0,align:{node:null,points:["cc","cc"]}})}return{init:function(){var a=b.all("#content .J_YunMobileRefund");if(a.length){var c=d();a.on("click",function(a){a.preventDefault(),c.show()}),c.on("afterRenderUI",function(){b.one(document).on("click",function(a){var d=b.one(a.target),e=c.get("el");d.hasClass("J_YunMobileRefund")||e.contains(d)||c.hide()})})}}}},{requires:["node","overlay"]}),KISSY.add("widget/iframe_dialog/index",function(a,b){function c(b){var e=this;b=a.merge(d,b),c.superclass.constructor.call(e,b),e._cfg=b,e._init()}var d={elCls:"iframe-dialog",width:"",height:"",url:"",mask:!0,closable:!0,align:{node:null,points:["cc","cc"]}},e='<iframe scrolling="no" frameborder="0" allowTransparency="true" src="{url}"></iframe>';return a.extend(c,b.Dialog,{_init:function(){var b=this;b.on("show",function(){b._renderBody(),b.center()}),b.on("bodyRendered",function(){b._sizeIframe()}),a.UA.ie&&b.on("hide",function(){b.get("body").one("iframe").hide()})},_renderBody:function(){var b=this,c=a.substitute(e,b._cfg);b.get("body").html(c),b.fire("bodyRendered")},_sizeIframe:function(a){var b=this,c=b.get("body").one("iframe");a=a||b._cfg,c.css({width:a.width-40,height:a.height-20})},resize:function(b){if(a.isPlainObject(b)){var c=this;c.get("el").css(b),c._sizeIframe(b)}}}),c},{requires:["overlay"]}),KISSY.add("widget/iframe_dialog_manager/index",function(a,b){function c(b){var c=a.all(b);c.length&&this._init(c)}var d;return a.augment(c,{_init:function(b){var c=this;b.on("click",function(b){b.preventDefault(),c._activeDialog=c._getActiveDialog(a.one(this)),c._activeDialog.show()})},_getActiveDialog:function(a){var b=a.data("iframe-dialog");return b||(b=this._createDialog(a),a.data("iframe-dialog",b)),b},_createDialog:function(c){var d=a.unparam(c.attr("data"));return new b({width:parseInt(d.width,10),height:parseInt(d.height,10),url:c.attr("href")})},hide:function(){this._activeDialog&&this._activeDialog.hide()},resize:function(a){var b=this._activeDialog;if(b){var c=b.get("body").one("iframe"),d=parseInt(c.css("width"),10),e=parseInt(c.css("height"),10);b.resize({width:(a.width>d?a.width:d)+40,height:(a.height>e?a.height:e)+20})}}}),{instance:function(b){return d||(d=new c(b)),a.namespace("TM",!0),TM.IframeDialogManager=d,a.namespace("TB.app.Trade.DialogMgr",!0),TB.app.Trade.DialogMgr.hideDialog=function(){d.hide()},d}}},{requires:["widget/iframe_dialog/index"]}),KISSY.add("page/components/order_status_manager",function(a,b,c){function d(c){return b.all("#J_BoughtTable tbody").filter(function(d){return d=b.one(d),c==a.trim(d.attr("data-orderid"))}).item(0)}function e(a,b){var c=a.one(".status");c&&b&&c.replaceWith(b)}function f(a,b){var c=a.one(".operate");c&&c.html(b||"")}var g={update:function(b){if(a.isPlainObject(b)){c.instance(".J_DialogTrigger").hide();var g=d(b.orderId);g&&(e(g,b.tradeStatus),f(g,b.tradeOperate))}}};a.namespace("TM",!0),TM.OrderStatusManager=g},{requires:["node","widget/iframe_dialog_manager/index"]}),KISSY.add("page/mods/base/buddy",function(a,b,c,d,e){function f(){h.set("align",{node:i,points:["bl","tl"],offset:[7,4]})}function g(){i&&(h=new d.Popup({elCls:"buddy-tooltip",elBefore:i,width:40,content:'<p><b>\u53bb\u9886\u73b0\u91d1\u5956\u52b1</b></p><s class="triangle"></s>',closable:!1}),h.on("show",function(){f()}),e.on("toggleFilter deletedOrder",function(){f()}),h.show())}var h,i,j=c.all,k=!0,l=function(){function b(){return c}var c=-1!==location.hostname.indexOf(".daily.")||"file:"==location.protocol,d=function(){var a=Array.prototype.slice.call(arguments);if(a.length<2)return a[0]||"";var b=a.shift();return b+=b.indexOf("?")>0?"&":"?",b+a.join("&").replace(/&+/g,"&")};return function(c,e){return c=b()?c.replace("a.tbcdn.cn","assets.daily.taobao.net").replace("taobao.com","daily.taobao.net"):c.replace("assets.daily.taobao.net","a.tbcdn.cn").replace("daily.taobao.net","taobao.com"),e?d(c,"t="+a.now()):c}}();return{init:function(){var c=j("#J_MainBizIds").val();c&&(b({type:"get",url:l("http://tbskip.daily.taobao.net/json/show_buddy_biz_order.do"),data:{bizOrderId:c},dataType:"jsonp",success:function(b){k&&b.orders&&b.orders.length&&a.each(b.orders,function(a,b){if(a.orderId){var c=j(".mainOrder"+a.orderId);if(c.one(".sns-share")){var d=l("http://follow.daily.taobao.net/buddy_detail.htm?BizOrderId="+a.orderId);c.one(".sns-share").html('<a href="'+d+'" target="_blank" class="buddy">\u8fd4\u73b0</a>'),0===b&&(i=c.one(".buddy"),g())}}})}}),setTimeout(function(){k=!1},3e3))}}},{requires:["ajax","node","overlay","widget/event_center/index"]}),KISSY.add("page/mods/base/order_shortcut",function(a,b){return{init:function(){var a="ordertype-expand",c=b.one("#J_OrderType"),d=c&&c.one(".trigger");d&&(d.on("click",function(b){b.halt(),c.toggleClass(a)}),b.one(document).on("click",function(b){c.contains(b.target)||c.removeClass(a)}))}}},{requires:["node"]}),KISSY.add("widget/make_point/index",function(a){function b(b){var c=a.trim(b.attr("data-point-url"));return c+(-1!=c.indexOf("?")?"&":"?")+"cache="+a.now()}function c(b){var c=a.trim(b.attr("data-action-name"));return c?"mouse"===c&&(c="mouseenter"):c="click",c}return{addPoint:function(d){var e=this;d=a.one(d),d&&d.all(".J_MakePoint").each(function(d){d=a.one(d);var f=c(d);"auto"===f?e.request(b(d)):d.on(f,function(){e.request(b(d))})})},request:function(a){(new Image).src=a}}}),KISSY.add("page/mods/base/complain",function(a,b,c,d,e,f){function g(b){c({url:b,cache:!1,dataType:"script",success:function(){return a.isPlainObject(serviceoneRightsJson)?(h(serviceoneRightsJson),void 0):(alert("\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5\uff01"),void 0)},error:function(){alert("\u8fde\u63a5\u9519\u8bef")},scriptCharset:"gbk"})}function h(b){var c=b.result;b.isSuccess?location.href=c.url:a.isPlainObject(c)&&(k=k||new e(l),j.show(),j.set("bodyContent",k.render(c)),j.center())}function i(){var a=new d.Dialog({elCls:"tm-dialog-blue complain-dialog",width:490,closable:!0});return a.on("afterRenderUI",function(){b.one(document).on("click",function(c){var d=b.one(c.target),e=a.get("el"),f=a.get("currentTrigger");d==f||e.contains(d)||a.hide()})}),a.on("hide",function(){var b=a.get("currentTrigger");f.request(b.attr("data-point-hidedialog"))}),a}var j,k,l='<div class="msg24"><div class="attention"><h3>{{head}}</h3><p>{{{body}}}</p><p>{{foot}}</p></div></div>';return{init:function(){var a=b.all("#J_BoughtTable .J_ApplyRepayTrigger");a.length&&(j=i(),a.on("click",function(a){a.preventDefault();var c=b.one(this);g(c.attr("url")),j.set("currentTrigger",c)}))}}},{requires:["node","ajax","overlay","xtemplate","widget/make_point/index"]}),KISSY.add("page/mods/base/buyer_message",function(a,b,c,d){function e(c){var d=c.attr(i);d?h.set("content",a.unEscapeHTML(d)):(h.set("content","\u6b63\u5728\u52a0\u8f7d..."),b({dataType:"json",url:c.attr("data-url"),data:{t:a.now()},success:function(b){var d=f(b);h.set("content",d),c.attr(i,a.escapeHTML(d))},error:function(){h.set("content","\u5bf9\u4e0d\u8d77\uff0c\u6682\u65f6\u65e0\u6cd5\u83b7\u5f97\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5\u3002")}}))}function f(b){var c='<h5>\u8054\u7cfb\u4fe1\u606f</h5><table><tbody><tr><th>\u7559\u8a00\uff1a</th><td class="message">{message}</td></tr></tbody></table><s class="triangle"></s>';return a.substitute(c,{message:(b.message||"").replace(/\n/g,"<br />")})}function g(a){return new d.Popup({elCls:"buyer-message",trigger:a,triggerType:"mouse",mouseDelay:.3,width:230,effect:{effect:"fade",duration:.5}})}var h,i="data-userinfo";return{init:function(){var a=c.one("#J_BoughtTable"),b=a&&a.all(".uinfo-icon").add(".vuinfo-icon");b.length&&(h=g(b),h.on("show",function(){var a=h.get("currentTrigger");e(a),h.set("align",{node:a,points:["tr","tl"],offset:[8,-16]})}),h.on("hide",function(){h.set("xy",[-9999,-9999])}))}}},{requires:["ajax","node","overlay"]}),KISSY.add("page/mods/base/share",function(a,b,c,d){function e(c){if("undefined"!=typeof SNS&&"object"==typeof SNS)try{var g=d.parse(c.attr("data-param"));g.callback={render:f},SNS.ui("share",g)}catch(h){a.log(h,"error")}else b({url:"http://a.tbcdn.cn/p/snsdk/core.js",dataType:"script",success:function(){e(c)}})}function f(){var a='<div class="share-tooltip"><p>\u597d\u5b9d\u8d1d\u8981\u5206\u4eab\uff0c\u70b9\u4eae\u5c0f\u56fe\u6807\uff0c\u70ab\u8000\u4e00\u4e0b\u5427\uff01<a href="http://guang.taobao.com/double12/index.htm" target="_blank">\u5feb\u53bb\u770b\u770b</a></p><s class="triangle"></s></div>',b=c.one("#J_ArticleWithMaxNotice .selected-bd");b&&b.append(a)}return{init:function(){var a=c.all("#J_BoughtTable .J_ShareSNS");a.length&&a.on("click",function(a){a.preventDefault(),e(c.one(this))})}}},{requires:["ajax","node","json"]}),KISSY.add("page/mods/base/pagenation",function(a,b){return{init:function(){var c=b.one("#J_JumpTo"),d=b.one("#J_PageNum");c&&d&&(c.on("click",function(){var c=parseInt(d.val(),10);a.isNumber(c)&&!isNaN(c)&&(location.href=b.one(this).attr("data-url")+"&pageNum="+c)}),d.on("keypress",function(a){13===a.keyCode&&(a.preventDefault(),c.fire("click"))}))}}},{requires:["node"]}),KISSY.add("page/mods/base/expand_suborder",function(a,b){function c(a){var b=a.parent("tbody"),c=b.all("tr.last");a.parent().remove(),b.all("tr.extra").removeClass("extra"),2==c.length&&c.item(0).removeClass("last")}function d(b){var c=b.parent("tbody"),d=c.all("tr.order-bd"),e=d.length,f=d.item(0),g=["td.amount","td.trade-status","td.operate","td.other"];a.each(g,function(a){var b=f.one(a);b&&b.attr("rowSpan",e)})}return{init:function(){var a=b.all("#J_BoughtTable .J_expandTrigger");a.length&&a.on("click",function(a){a.preventDefault();var e=b.one(this);d(e),c(e)})}}},{requires:["node"]}),KISSY.add("page/mods/base/monitor",function(a,b){return{init:function(){b.addPoint("#main-content")}}},{requires:["widget/make_point/index"]}),KISSY.add("page/mods/base/treasure",function(a,b,c){function d(a){var b="<p>"+a.attr("data-message")+'</p><i class="triangle"></i>';f.set("content",b)}function e(a){f.set("align",{node:a,points:["bl","tl"],offset:[0,6]})}var f;return{init:function(){var a=b.all("#J_BoughtTable .J_Treasure");a.length&&(f=new c.Popup({elCls:"treasure-tooltip",trigger:a,triggerType:"mouse",width:234,closable:!1}),f.on("show",function(){var a=f.get("currentTrigger");d(a),e(a)}))}}},{requires:["node","overlay"]}),KISSY.add("page/reuse_scenes/base",function(a,b){var c=a.makeArray(arguments).slice(2);return{init:function(){b.initMods(c)}}},{requires:["widget/page_manager/index","../mods/base/buddy","../mods/base/order_shortcut","../mods/base/complain","../mods/base/buyer_message","../mods/base/share","../mods/base/pagenation","../mods/base/expand_suborder","../mods/base/monitor","../mods/base/treasure"]}),KISSY.add("page/mods/bought/toggle_filter",function(a,b,c){return{init:function(){var a=b.one("#J_SearchBoxToggle"),d=b.one("#J_QueryConditionForm"),e=b.one("#J_FormExpandCls");if(a&&d&&e){var f="bought-search-more";a.on("click",function(a){a.preventDefault(),d.toggleClass(f),e.val(d.hasClass(f)?f:""),c.fire("toggleFilter")})}}}},{requires:["node","widget/event_center/index"]}),KISSY.add("page/mods/bought/trade_time",function(a,b,c,d){function e(a,c){var d=b.one("#J_TradeStatus"),e=b.one("#J_AfterServiceStatus");d&&e&&(a.on("focus",function(){f(d)}),a.on("blur",function(){g(d)}),c.on("focus",function(){f(e)}),c.on("blur",function(){g(e)}))}function f(a){a.css("visibility","hidden")}function g(a){a.css("visibility","visible")}return{init:function(){var f=b.one("#J_BeginTime"),g=b.one("#J_EndTime");f&&g&&(a.each([f,g],function(b){new d(b,{popup:!0,triggerType:["focus"],closable:!0,minDate:new Date("2003/1/1"),maxDate:new Date}).on("select",function(c){b.val(a.Date.format(c.date,"isoDate"))})}),6===c.ie&&e(f,g))}}},{requires:["node","ua","calendar"]}),KISSY.add("widget/checkbox/index",function(a,b,c){function d(b){var c=this;c.cfg=a.merge(f,b),c._init(c.cfg)}var e={},f={selectAll:"",checkbox:""};return a.augment(d,c.Target,{_init:function(){var a=this,c=a.cfg,d=b.all(c.selectAll);d.on("click",function(){var e=b.all(c.checkbox),f=d.add(e);this.checked?(a._setSelectStatus(f,!0),a.fire("selectAll",{checkboxs:e})):(a._setSelectStatus(f,!1),a.fire("unSelectAll",{checkboxs:e}))}),b.all(c.checkbox).on("click",function(){a._setSelectStatus(d,a.isAllSelected()),a.fire(this.checked?"select":"unSelect",{checkbox:b.one(this)})})},_setSelectStatus:function(b,c){a.each(b,function(a){a.disabled||(a.checked=c)})},isAllSelected:function(){return a.every(b.all(this.cfg.checkbox),function(a){return a.disabled||a.checked})},getSelected:function(){var c=[];return a.each(b.all(this.cfg.checkbox),function(a){!a.disabled&&a.checked&&c.push(b.one(a))}),c}}),{instance:function(b){var c=a.trim(b.selectAll);return e[c]||(e[c]=new d(b)),e[c]}}},{requires:["node","event"]}),KISSY.add("page/mods/bought/batch_confirm_goods",function(a,b,c){function d(a){var b=g.getSelected(),c=e(b);b.length?c.length?f(a):alert('"\u5356\u5bb6\u5df2\u53d1\u8d27"\u72b6\u6001\u7684\u8ba2\u5355\u624d\u80fd\u8fdb\u884c\u786e\u8ba4\u6536\u8d27\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9'):alert("\u8bf7\u9009\u62e9\u8981\u786e\u8ba4\u6536\u8d27\u7684\u5b9d\u8d1d,\u53ef\u4ee5\u9009\u62e9\u591a\u4e2a")}function e(b){var c=/^WAIT_BUYER_CONFIRM_GOODS$/;return a.filter(b,function(b){var d=b.parent("tbody").attr("data-status"),e=c.test(a.trim(d));return e})}function f(a){var c=b.one("#J_BoughtListForm");c&&(c.attr({action:a,target:"_blank"}),c.fire("submit"))}var g;return{init:function(){var a=b.all("#J_BoughtTable .J_BatchReceive");a.length&&(g=c.instance({selectAll:"#J_BoughtTable .J_AllSelector",checkbox:"#J_BoughtTable .J_Selector"}),a.on("click",function(a){a.preventDefault(),d(b.one(this).attr("data-url"))}))}}},{requires:["node","widget/checkbox/index"]}),KISSY.add("page/mods/bought/combin_pay",function(a,b,c,d){function e(a){var b=k.getSelected(),c=f(b),d=c.length,e=b.length;d?d==e?g(a.attr("data-url")):(j.set("combinUrl",a.attr("data-url")),j.set("combinConfirmUrl",a.attr("data-confirm-url")),j.show()):alert("\u8bf7\u9009\u62e9\u5b9d\u8d1d\u4ed8\u6b3e,\u53ef\u4ee5\u9009\u62e9\u591a\u4e2a")}function f(b){var c=/^(?:WAIT_BUYER_PAY|PLS_USE_ZFB)$/;return a.filter(b,function(b){var d=b.parent("tbody").attr("data-status"),e=c.test(a.trim(d));return e||(b.checked=!1),e})}function g(a){var c=b.one("#J_BoughtListForm");c&&(c.attr({action:a,target:"_blank"}),c.fire("submit"))}function h(){var a=new c.Dialog({elCls:"iframe-dialog combinpay-dialog",bodyContent:l,width:742,height:256,closable:!0,mask:!0,align:{node:null,points:["cc","cc"]}});return a.on("afterRenderUI",function(){b.one(".J_BackChoose").on("click",function(b){b.preventDefault(),a.hide()}),b.one("#J_PayForAvailable").on("click",function(b){b.preventDefault(),g(a.get("combinUrl")),a.hide()})}),a.on("show",function(){var a=k.getSelected(),c=f(a);b.one("#J_UnSupportCombin").html(a.length-c.length),b.one("#J_CombinIframe").attr({src:i(c)})}),a}function i(c){var d=[],e=j.get("combinConfirmUrl");return a.each(c,function(a){d.push("bizOrderId="+b.one(a).val())}),e+(-1!==e.indexOf("?")?"&":"?")+d.join("")}var j,k,l='<div class="msg"><p class="attention">\u6dd8\u5b9d\u63d0\u9192\u60a8\uff1a\u60a8\u6709<span id="J_UnSupportCombin"></span>\u7b14\u8ba2\u5355\u4e0d\u652f\u6301\u5408\u5e76\u4ed8\u6b3e</p></div><div style="margin-top:30px"><a href="javascript:void(0)" class="J_BackChoose">\u8fd4\u56de\u91cd\u65b0\u9009\u62e9</a>\u6216\u7ee7\u7eed\u5bf9\u4ee5\u4e0b\u8ba2\u5355<a id="J_PayForAvailable" href="#" class="small-long-btn">\u5408\u5e76\u4ed8\u6b3e</a></div><iframe id="J_CombinIframe" src="about:blank" style="margin-top:10px;width:700px;height:130px" frameborder="0" scrolling="auto"></iframe>';return{init:function(){var c=b.all("#content .J_CombinPay"),f=b.all("#content .J_CombinAgentPay");(c.length||f.length)&&(j=h(),k=d.instance({selectAll:"#J_BoughtTable .J_AllSelector",checkbox:"#J_BoughtTable .J_Selector"}),a.each([c,f],function(a){a.on("click",function(a){a.preventDefault(),e(b.one(this))})}))}}},{requires:["node","overlay","widget/checkbox/index"]}),KISSY.add("page/mods/bought/filter_by_tradestatus",function(a,b){return{init:function(){var a=b.one("#J_TradeStatusHandle");if(a){var c=b.one("#J_TradeStatus"),d=b.one("#J_QueryConditionForm");a.on("change",function(){c.val(b.one(this).val()),d.fire("submit")})}}}},{requires:["node"]}),KISSY.add("page/mods/bought/cancel_order",function(a,b,c){function d(a){var b=a.one("td.trade-status"),c=a.one(".detail-link"),d='<a href="'+c.attr("href")+'" class="status closed" target="_blank">\u4ea4\u6613\u5173\u95ed</a>';b.html("").append(d).append(c.parent())}return{init:function(){var e=window,f=c.instance("#main-content .J_DialogTrigger");e.closeOrder=function(c){var e=b.all("#J_BoughtTable tbody"),f=e.filter(function(d){return d=b.one(d),c===a.trim(d.attr("data-orderid"))})[0];f=b.one(f),f&&(f.parent().addClass("close-order"),f.one("td.operate").html(""),d(f,c))},e.closeCancelOrderDialog=function(){f.hide()}}}},{requires:["node","widget/iframe_dialog_manager/index"]}),KISSY.add("page/components/confirm_dialog",function(a,b){function c(b){b=a.merge(d,b),c.superclass.constructor.call(this,b),this._init()}var d={elCls:"tm-dialog-gray confirm-dialog",width:360,height:124,mask:!0,closable:!0,align:{node:null,points:["cc","cc"]},headerContent:"",bodyContent:"",footerContent:'<span class="J_Confirm skin-blue"><button type="submit" class="short-btn">\u786e\u8ba4</button></span><span class="J_Cancel skin-gray"><button type="button" class="short-btn">\u53d6\u6d88</button></span>'};return a.extend(c,b.Dialog,{_init:function(){var a=this;a.on("afterRenderUI",function(){var b=a.get("el");b.one(".J_Confirm").on("click",function(b){b.preventDefault(),a.hide(),a.fire("confirm")}),b.one(".J_Cancel").on("click",function(b){b.preventDefault(),a.hide()})}),a.on("show",function(){a.center()})}}),c},{requires:["overlay"]}),KISSY.add("page/components/order_info",function(a,b){return{get:function(a){return{orderId:a.attr("data-orderid"),isArchive:a.attr("data-isArchive")}},getSome:function(c){var d=[],e=[];return a.each(c,function(a){var c=b.one(a).parent("tbody");d.push(c.attr("data-orderid")),e.push(c.attr("data-isArchive"))}),{orderIds:d.join(),isArchives:e.join()}}}},{requires:["node"]}),KISSY.add("page/components/order_animation",function(a,b){function c(a){var c=a.width(),d=a.height(),f=a.offset(),g=b("<div>"),h=b('<table class="bought-table"></table>');return h.append(a),g.append(h).appendTo(document.body),g.add(h).css({width:c+e,height:d+e}),g.css({position:"absolute",top:f.top+e,left:f.left+e,overflow:"hidden",margin:"auto"}),g}function d(a){var c=b.one(document).scrollTop(),d=a.offset(),f=d.top;return{width:0,height:0,top:(c>f?c-30:f)+e,left:d.left+e}}var e="px";return{start:function(a){var b,e,f,g=this,h=a.msg,i=a.el,j=a.endPoint;j?(b=c(i),e="",f=d(j)):(e="easeOut",b=i,f={opacity:0}),b.animate(f,.5,e,function(){b.remove(),h&&g.showTip(h)})},showTip:function(c,d){var e=b.one("#J_recyleTip"),f=d?"error":"ok";e&&(e.html('<p class="'+f+'">'+c+"</p>").show(),a.later(function(){e.hide()},4e3))}}},{requires:["node"]}),KISSY.add("page/components/order_manager",function(a,b,c,d,e,f){function g(a,b){var c=e.get(a.parent("tbody"));i({act:a.attr("data-action"),order_ids:c.orderId,isArchive:c.isArchive,success:b})}function h(c,d,f){var g=e.getSome(d);i({act:c.attr("data-action"),order_ids:g.orderIds,isArchives:g.isArchives,success:function(){a.each(d,function(a){a=b.one(a),a.parent("tbody").remove()}),f&&f()}})}function i(d){var e={t:a.now()},g=b.one("#J_Token"),h=d.success||function(){};delete d.success,g&&(e._tb_token_=g.val()),c({type:"POST",url:"/trade/itemlist/recyled_order.htm",data:a.merge(e,d),success:h,error:function(){f.showTip("\u7cfb\u7edf\u7e41\u5fd9\uff0c\u64cd\u4f5c\u5931\u8d25",!0)}})}return{del:function(a){g(a,function(){f.start({el:a.parent("tbody"),msg:"\u6210\u529f\u79fb\u81f3\u8ba2\u5355\u56de\u6536\u7ad9",endPoint:b.one("#J_orderRecyleBin")}),d.fire("deletedOrder")})},shiftDel:function(a){g(a,function(){f.start({el:a.parent("tbody")})})},restore:function(a){var c=b.one("#J_OrderType");g(a,function(){f.start({el:a.parent("tbody"),msg:"\u6210\u529f\u8fd8\u539f\u8ba2\u5355",endPoint:c&&c.parent()})})},batchShiftDel:function(a,b){h(a,b)},batchRestore:function(a,b){h(a,b,function(){f.showTip("\u8ba2\u5355\u8fd8\u539f\u6210\u529f\uff0c\u8bf7\u53bb\u5df2\u4e70\u5230\u5b9d\u8d1d\u67e5\u770b")})}}},{requires:["node","ajax","widget/event_center/index","./order_info","./order_animation"]}),KISSY.add("page/mods/bought/delete_order",function(a,b,c,d){return{init:function(){var a=b.all("#J_BoughtTable .J_DelOrder");if(a.length){var e=new c({headerContent:"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u8ba2\u5355\u4e48\uff1f",bodyContent:"\u5220\u9664\u540e\uff0c\u60a8\u53ef\u5728\u8ba2\u5355\u56de\u6536\u7ad9\u627e\u56de\uff0c\u6216\u6c38\u4e45\u5220\u9664"});a.on("click",function(a){a.preventDefault(),e.show(),e.set("activeTrigger",b.one(this)),this.blur()}),e.on("confirm",function(){d.del(e.get("activeTrigger"))})}}}},{requires:["node","../../components/confirm_dialog","../../components/order_manager"]}),KISSY.add("page/mods/bought/novice_hint",function(a,b,c,d,e){function f(){var a=l.get("el").all(".J_Category");b.one("#J_TipsNext").on("click",h),b.one("#J_TipsPrev").on("click",g),a.on("click",function(a){a.preventDefault(),j(b.one(this).attr("data-category"))}),n.onReadyShowTips?j(k(n.remindType)):i(1)}function g(){var a=l.get("lastPageNumber"),b=n.newfishTips.length;i(1===a?b:a-1)}function h(){var a=l.get("lastPageNumber"),b=n.newfishTips.length;i(a===b?1:a+1)}function i(c){var d=n.newfishTips,e=d[c-1];if(a.isPlainObject(e)){var f=l.get("el"),g=f.one(".active"),h=f.one("."+e.category);g&&g.removeClass("active"),h&&h.addClass("active"),l.set({lastPageNumber:c,bodyContent:m.render(e)}),b.one("#J_TipCount").html(c+"/"+d.length)}}function j(b){var c=0;a.each(n.newfishTips,function(a,d){return b===a.category?(c=d+1,!1):void 0}),c&&i(c)}function k(a){var b=["unpay","unsend","sended","succeed"];return b[a]||b[0]}var l,m,n,o={header:'<h4>\u8d2d\u7269\u5c0f\u8d34\u58eb</h4><ul class="categorys"><li><a data-category="unpay" class="J_Category unpay" href="#">\u62cd\u4e0b\u672a\u4ed8\u6b3e</a></li><li><a data-category="unsend" class="J_Category unsend" href="#">\u4ed8\u6b3e\u672a\u53d1\u8d27</a></li><li><a data-category="sended" class="J_Category sended" href="#">\u4ed8\u6b3e\u5df2\u53d1\u8d27</a></li><li><a data-category="succeed" class="J_Category succeed" href="#">\u4ea4\u6613\u6210\u529f</a></li></ul>',body:'<h4>{{question}}</h4>{{#if answerTitle}}<h5>{{answerTitle}}</h5>{{/if}}{{#if answerList.length > 1}}<ol>{{#each answerList}}<li>{{{this}}}</li>{{/each}}</ol>{{else}}{{#each answerList}}<p>{{{this}}}</p>{{/each}}{{/if}}{{#if moreLink}}<a class="more" target="_blank" href="{{moreLink}}">\u66f4\u591a\u89e3\u91ca\u8bf4\u660e\u8bf7\u70b9\u51fb\u8fd9\u91cc</a>{{/if}}',footer:'<div class="pagination"><button id="J_TipsPrev">\u4e0a\u4e00\u6761</button><em id="J_TipCount"></em><button id="J_TipsNext">\u4e0b\u4e00\u6761</button></div>'};return{init:function(){var g=b.one("#J_NewfishTipTrigger"),h=a.get("#J_NoviceData");g&&h&&(n=c.parse(h.value),m=new e(o.body),l=new d.Dialog({elCls:"novice-dialog",headerContent:o.header,footerContent:o.footer,width:482,height:260,closable:!0,align:{node:null,points:["cc","cc"]},effect:{target:g,easing:"easyBoth",duration:.3}}),l.on("afterRenderUI",f),l.on("show",function(){l.center()}),g.on("click",function(a){a.preventDefault(),l.show()}),n.onReadyShowTips&&l.show())}}},{requires:["node","json","overlay","xtemplate"]}),KISSY.add("page/mods/bought/rebuy_normal",function(a,b,c,d){function e(c){b({type:"get",url:c,dataType:"json",success:function(b){if(!b||!a.isPlainObject(b.result))return f(i.error),void 0;var c,d=b.result;"success"===d.status?location.href=d.url:"2"==""+d.error?(c=a.substitute(i.fullcart,{url:d.url}),f(c)):f(i.error)},error:function(){f(i.error)}})}function f(a){h.show().center().set("bodyContent",a)}function g(){return new d.Dialog({elCls:"tm-dialog-blue rebuy-dialog",bodyContent:i.loading,width:520,mask:!0,closable:!0,align:{node:null,points:["cc","cc"]}})}var h,i={fullcart:'<div class="msg24"><p class="attention">\u52a0\u5165\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u5df2\u8d85\u8fc7\u8d2d\u7269\u8f66\u6700\u5927\u5bb9\u91cf\uff0c\u8bf7\u5148\u6574\u7406\u8d2d\u7269\u8f66\u3002</p><p class="detail">\u73b0\u5728\u5c31\u53bb\u6574\u7406<a class="J_Detail" href="{url}" target="_blank">\u6211\u7684\u8d2d\u7269\u8f66&gt;&gt;</a></p></div>',loading:'<div class="tm-indicator"><p class="loading"><i></i>\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</p></div>',error:'<div class="msg24"><p class="attention">\u52a0\u5165\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002</p><p class="detail">\u60a8\u8fd8\u53ef\u4ee5\u8fdb\u5165\u5546\u54c1\u8be6\u60c5\u9875\u8fdb\u884c\u8d2d\u4e70\u3002</p></div>'};return{init:function(){var a=c.all("#J_BoughtTable .J_RebuyAll");a.length&&(h=g(),a.on("click",function(a){a.preventDefault(),e(c.one(this).attr("data-url")),this.blur()}),h.on("afterRenderUI",function(){h.get("body").delegate("click",".J_Detail",function(){h.hide()})}))}}},{requires:["ajax","node","overlay"]}),KISSY.add("page/mods/bought/rebuy_virtual",function(a,b,c,d){function e(c){b({url:c,type:"get",dataType:"jsonp",data:{t:a.now()},success:function(b){return a.isPlainObject(b)&&"error"!=b.result?(b.isCanBuy?location.href=b.url:f(a.substitute(i.unbuy,{url:b.url})),void 0):(f(i.error),void 0)},error:function(){f(i.error)},charset:"gbk"})}function f(a){h.show().center().set("bodyContent",a)}function g(){return new d.Dialog({elCls:"tm-dialog-blue rebuy-dialog rebuy-virtual",bodyContent:i.loading,width:520,mask:!0,closable:!0,align:{node:null,points:["cc","cc"]}})}var h,i={unbuy:'<div class="msg24"><p class="attention">\u8be5\u5b9d\u8d1d\u5df2\u4e0b\u67b6\u6216\u88ab\u5356\u5bb6\u91cd\u65b0\u7f16\u8f91\u8fc7\uff01</p><p class="detail">\u8bf7\u5230\u5b9d\u8d1d\u8be6\u60c5\u9875\u786e\u8ba4\u8be5\u5b9d\u8d1d\u4fe1\u606f\uff0c<a class="J_Detail" href="{url}" target="_blank">\u67e5\u770b\u8be5\u5b9d\u8d1d\u8be6\u60c5\u9875&gt;&gt;</a></p></div>',loading:'<div class="tm-indicator"><p class="loading"><i></i>\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</p></div>',error:'<div class="tm-indicator"><p class="failure">\u7cfb\u7edf\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01</p></div>'};return{init:function(){var a=c.all("#J_BoughtTable .J_Rebuy");a.length&&(h=g(),a.on("click",function(a){a.preventDefault(),e(c.one(this).attr("data-url")),this.blur()}),h.on("afterRenderUI",function(){h.get("body").delegate("click",".J_Detail",function(){h.hide()})}))}}},{requires:["ajax","node","overlay"]}),KISSY.add("page/mods/bought/remind_deliver_goods",function(a,b,c){function d(c){b({url:c,type:"get",success:function(b){"true"===a.trim(b)?alert("\u63d0\u9192\u53d1\u9001\u6210\u529f\uff01"):alert("\u63d0\u9192\u53d1\u9001\u5931\u8d25\uff01")},error:function(){alert("\u63d0\u9192\u53d1\u9001\u5931\u8d25\uff01")}})}return{init:function(){var a=c.all("#J_BoughtTable .J_RemindDeliver");a.length&&a.on("click",function(a){a.preventDefault(),d(c.one(this).attr("data-url"))})}}},{requires:["ajax","node"]}),KISSY.add("page/mods/bought/terminate_order",function(a,b,c){function d(b,c){var d=b.one("td.trade-status"),e='<a href="{url}" target="_blank" class="status {cls}">{text}</a>',f=a.substitute(e,{text:c?"\u4ea4\u6613\u6210\u529f":"\u4ea4\u6613\u5173\u95ed",cls:c?"success":"closed",url:b.one(".detail-link").attr("href")});d.prepend(f),b.addClass("close-order")}function e(a){var b=a.one("td.trade-status");b.html("\u672a\u5f00\u59cb").removeClass("current")}function f(a){a.one("td.operate").html("")}function g(b,c){var d=b.one("td.operate"),e='<span class="skin-white"><a href="{url}" target="_blank" class="small-btn button">\u8bc4\u4ef7</a></span>',f=a.substitute(e,{url:h(c)});d.append(f)}function h(b){var c="http://rate.{host}/remark_seller.jhtml?trade_id={orderId}&return_url={backJumpUrl}";return a.substitute(c,{orderId:b,backJumpUrl:location.href,host:location.host.indexOf("taobao.com")?"taobao.com":"daily.taobao.net"})}function i(a,b){return a.all(".J_Stage").item(b-1)}var j={terminate:function(h){if(c.instance(".J_DialogTrigger").hide(),a.isPlainObject(h)&&b.one("#item"+h.orderId)){var j=h.isTradeSuccess,k=a.trim(h.orderId),l=b.one("#item"+k).parent(),m=i(l,h.curStageIndex);l&&m&&(d(l,j),e(m),f(m)),j&&g(l,k)}}};return a.namespace("TM.OrderTerminater",!0),TM.OrderTerminater=j,j},{requires:["node","widget/iframe_dialog_manager/index"]}),KISSY.add("page/mods/bought/logistics.tpl",function(){var a='<div class="loading"><img src="http://img01.taobaocdn.com/tps/i1/T1cKm3XkRpXXXXXXXX-48-48.gif" /></div>',b='<p class="courier"><em class="name">{{expressName}}</em><em class="number">\u8fd0\u5355\u53f7\uff1a{{expressId}}</em></p><ul class="address">{{#each address}}{{#if isViewAll}}<li><span>\u4ee5\u4e0a\u4e3a\u6700\u65b0\u8ddf\u8e2a\u4fe1\u606f</span><a href="{{../url}}" target="_blank" class="J_ViewAll view-all">\u67e5\u770b\u5168\u90e8</a><i class="symbol"></i></li>{{else}}<li{{#if xindex === 0}} class="current"{{/if}}><span class="place">{{place}}</span><span class="time">{{time}}</span><i class="symbol"></i></li>{{/if}}{{/each}}</ul>',c='<div class="message"><p class="attention">\u83b7\u53d6\u7269\u6d41\u4fe1\u606f\u5931\u8d25\u3002</p></div>';return{loading:a,success:b,failure:c}}),KISSY.add("page/mods/bought/logistics",function(a,b,c,d,e,f,g){function h(){var b=c.all(".J_Logistics");return b.filter(function(b){var d="data-status",e=c.one(b).parent(function(a){return a=c.one(a),"tbody"===a.nodeName()&&a.hasAttr(d)});return"WAIT_BUYER_CONFIRM_GOODS"===a.trim(e.attr(d))})}var i,j="logisticsInfo",k={init:function(a){this.tpl=new e(g.success+a)},show:function(a){a.data(j)?this.render(a.data(j)):(i.set("content",g.loading),this.fetchData(a))},fetchData:function(c){var d=this,e=a.trim(c.attr("data-url"));return e?(new b({type:"get",url:e,dataType:"json",cache:!1,success:function(b){var e=!(a.isPlainObject(b)&&b.isSuccess&&b.expressName&&a.isArray(b.address)&&b.address.length);e?d.error():d.success(b,c)},error:function(){d.error()}}),void 0):d.error()},process:function(a){var b,c=a.address;return c.length>3&&(b=c.slice(0,2),b.push(c.pop()),b.splice(b.length-1,0,{isViewAll:!0}),a.address=b),a},parse:function(a){return a=this.process(a),this.tpl.render(a)},render:function(a){i.set("content",a)},success:function(a,b){var c;a.url=b.attr("href"),c=this.parse(a),this.render(c),b.data(j,c)},error:function(){this.render(g.failure)}},l={init:function(a){var b=this;a.item(0);var c=new d.Popup({elCls:"tm-tooltip logistics-tooltip",width:276,trigger:a,triggerType:"mouse",mouseDelay:.3});return c.on("afterRenderUI",function(){var a=c.get("el"),b=c.get("currentTrigger");a.append('<i class="arrow arrow-top"></i>'),a.delegate("click",".J_ViewAll",function(){f.request(b.attr("data-point-viewall"))})}),c.on("show",function(){b.setPostion(c)}),c},setPostion:function(a){a.set("align",{node:a.get("currentTrigger"),points:["bl","tl"],offset:[-12,4]})}};return{init:function(){var a=h(),b=c.one("#J_Mobile_Point_Link");a.length&&(i=l.init(a),k.init(b?b.val():""),i.on("afterCurrentTriggerChange",function(){var a=i.get("currentTrigger");
a&&(i.get("visible")&&i.hide(),k.show(i.get("currentTrigger")))}),i.on("show",function(){var a=i.get("currentTrigger");f.request(a.attr("data-point-show")),b&&f.request(a.attr("data-point-mobile"))}))}}},{requires:["ajax","node","overlay","xtemplate","widget/make_point/index","./logistics.tpl"]}),KISSY.add("page/bought",function(a,b){var c=a.makeArray(arguments).slice(2);a.ready(function(){b.initMods(c,!0)})},{requires:["widget/page_manager/index","widget/yun_mobile_refund/index","./components/order_status_manager","./reuse_scenes/base","./mods/bought/toggle_filter","./mods/bought/trade_time","./mods/bought/batch_confirm_goods","./mods/bought/combin_pay","./mods/bought/filter_by_tradestatus","./mods/bought/cancel_order","./mods/bought/delete_order","./mods/bought/novice_hint","./mods/bought/rebuy_normal","./mods/bought/rebuy_virtual","./mods/bought/remind_deliver_goods","./mods/bought/terminate_order","./mods/bought/logistics"]});